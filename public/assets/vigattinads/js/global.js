
/* trade category map v1.0 */
var catMap = {
    "vehicles" : {
        "id" : 1,
        "cat" : {
            "all"                           : {"id" : "all", "cat" : {}},
            "car accessories & parts"       : {"id" : 5, "cat" : {
                "audio/video devices"           : {"id" : 44, "cat" : {}},
                "body & main parts"             : {"id" : 113, "cat" : {}},
                "braking systems"               : {"id" : 45, "cat" : {}},
                "car seats & interiors"         : {"id" : 92, "cat" : {}},
                "car-care"                      : {"id" : 46, "cat" : {}},
                "decorative"                    : {"id" : 47, "cat" : {}},
                "electrical & electronics"      : {"id" : 48, "cat" : {}},
                "engine components"             : {"id" : 99, "cat" : {}},
                "filtration systems"            : {"id" : 49, "cat" : {}},
                "for security & emergency"      : {"id" : 53, "cat" : {}},
                "lights and hid"                : {"id" : 50, "cat" : {}},
                "mags and tires"                : {"id" : 51, "cat" : {}},
                "mufflers"                      : {"id" : 102, "cat" : {}},
                "oils and lubricants"           : {"id" : 52, "cat" : {}},
                "others"                        : {"id" : 55, "cat" : {}},
                "suspension & steering systems" : {"id" : 54, "cat" : {}}

            }},
            "car services"                  : {"id" : 6, "cat" : {
                "airconditioning"               : {"id" : 27, "cat" : {}},
                "auto detaling"                 : {"id" : 29, "cat" : {}},
                "car insurance"                 : {"id" : 30, "cat" : {}},
                "car loans"                     : {"id" : 28, "cat" : {}},
                "others"                        : {"id" : 96, "cat" : {}},
                "repair and under chassis"      : {"id" : 26, "cat" : {}},
                "trucking"                      : {"id" : 31, "cat" : {}}

            }},
            "cars for rent"                 : {"id" : 68, "cat" : {}},
            "cars, sedans & minivans"       : {"id" : 1, "cat" : {}},
            "coupés & convertibles"         : {"id" : 39, "cat" : {}},
            "heavy equipment"               : {"id" : 143, "cat" : {}},
            "heavy equipment for rent"      : {"id" : 74, "cat" : {}},
            "hybrids & evs"                 : {"id" : 40, "cat" : {}},
            "luxury & sports cars"          : {"id" : 41, "cat" : {}},
            "motorcycle parts & acc"        : {"id" : 8, "cat" : {
                "audio"                         : {"id" : 98, "cat" : {}},
                "braking systems"               : {"id" : 97, "cat" : {}},
                "fairings"                      : {"id" : 59, "cat" : {}},
                "helmets and safety gears"      : {"id" : 56, "cat" : {}},
                "mags and tires"                : {"id" : 57, "cat" : {}},
                "mufflers"                      : {"id" : 58, "cat" : {}},
                "others"                        : {"id" : 95, "cat" : {}},
                "suspension system"             : {"id" : 103, "cat" : {}}
            }},
            "motorcycles & scooters"        : {"id" : 7, "cat" : {}},
            "suvs, crossovers & pickups"    : {"id" : 2, "cat" : {}},
            "trucks and buses for rent"     : {"id" : 69, "cat" : {}},
            "trucks, trailers & buses"      : {"id" : 4, "cat" : {}},
            "vans & rvs"                    : {"id" : 3, "cat" : {}},
            "other vehicles"                : {"id" : 104, "cat" : {}}
        }
    },
    "real estate" : {
        "id" : 2,
        "cat" : {
            "all"                           : {"id" : "all", "cat" : {}},
            "apartments & condos"           : {"id" : 9, "cat" : {}},
            "beaches & resorts"             : {"id" : 11, "cat" : {}},
            "commercial & industrial"       : {"id" : 12, "cat" : {}},
            "house & lots, townhouses"      : {"id" : 10, "cat" : {}},
            "lands & farms"                 : {"id" : 13, "cat" : {}},
            "memorial lot areas"            : {"id" : 14, "cat" : {}},
            "real estate services"          : {"id" : 15, "cat" : {
                "appraisals & brokerage"        : {"id" : 36, "cat" : {}},
                "architecture"                  : {"id" : 33, "cat" : {}},
                "contracting"                   : {"id" : 32, "cat" : {}},
                "interior designs"              : {"id" : 34, "cat" : {}},
                "landscape architecture"        : {"id" : 38, "cat" : {}},
                "others"                        : {"id" : 109, "cat" : {}}
            }},
            "rooms & bedspace for rent"     : {"id" : 75, "cat" : {}}
        }
    },
    "general category": {
        "id" : 4,
        "cat" : {
            "all"                               : {"id" : "all", "cat" : {}},
            "animals & pets"                    : {"id" : 64, "cat" : {
                "accessories"                   : {"id" : 125, "cat" : {}},
                "birds"                         : {"id" : 126 , "cat" : {}},
                "cats & dogs"                   : {"id" : 127 , "cat" : {}},
                "exotic"                        : {"id" : 128 , "cat" : {}},
                "fish"                          : {"id" : 129 , "cat" : {}},
                "livestock"                     : {"id" : 130 , "cat" : {}},
                "others"                        : {"id" : 131 , "cat" : {}}
            }},
            "appliances"                        : {"id" : 24, "cat" : {}},
            "arts & crafts"                     : {"id" : 119, "cat" : {}},
            "baby stuffs"                       : {"id" : 115, "cat" : {}},
            "books & other publications"        : {"id" : 175, "cat" : {}},
            "chemicals"                         : {"id" : 100, "cat" : {}},
            "computers & related items"         : {"id" : 116, "cat" : {
                "laptops & notebooks"           : {"id" : 134, "cat" : {}},
                "monitors"                      : {"id" : 196, "cat" : {}},
                "others"                        : {"id" : 180, "cat" : {}},
                "parts & accessories"           : {"id" : 135, "cat" : {}},
                "printers and scanners"         : {"id" : 195, "cat" : {}},
                "software"                      : {"id" : 136, "cat" : {}},
                "storage"                       : {"id" : 137, "cat" : {}}
            }},
            "electronics"                       : {"id" : 21, "cat" : {
                "audio & video"                 : {"id" : 138, "cat" : {}},
                "cameras"                       : {"id" : 139, "cat" : {}},
                "e-books"                       : {"id" : 142, "cat" : {}},
                "gadgets"                       : {"id" : 140, "cat" : {}},
                "others"                        : {"id" : 176, "cat" : {}}
            }},
            "farming & gardening"               : {"id" : 120, "cat" : {}},
            "food & related items"              : {"id" : 23, "cat" : {
                "cooking equipment"             : {"id" : 143, "cat" : {}},
                "drinks & beverages"            : {"id" : 144, "cat" : {}},
                "fruits & vegetables"           : {"id" : 147, "cat" : {}},
                "others"                        : {"id" : 150, "cat" : {}},
                "seafoods & meats"              : {"id" : 145, "cat" : {}},
                "seasoning & condiments"        : {"id" : 148, "cat" : {}},
                "snacks, desserts & delicacies" : {"id" : 149, "cat" : {}}

            }},
            "footwear, clothing & acc."         : {"id" : 25, "cat" : {
                "bags & wallets"                : {"id" : 151, "cat" : {}},
                "casual & formal wear"          : {"id" : 152, "cat" : {}},
                "costumes"                      : {"id" : 153, "cat" : {}},
                "gowns & dresses"               : {"id" : 154, "cat" : {}},
                "head & hair accessories"       : {"id" : 155, "cat" : {}},
                "jewelries & watches"           : {"id" : 156, "cat" : {}},
                "others"                        : {"id" : 177, "cat" : {}},
                "pants & jeans"                 : {"id" : 157, "cat" : {}},
                "shirts & blouses"              : {"id" : 159, "cat" : {}},
                "shoes, slippers & sandals"     : {"id" : 160, "cat" : {}},
                "shorts & skirts"               : {"id" : 161, "cat" : {}},
                "socks & stockings"             : {"id" : 158, "cat" : {}},
                "sportswear"                    : {"id" : 174, "cat" : {}},
                "undergarments"                 : {"id" : 162, "cat" : {}}
            }},
            "for security & emergency"          : {"id" : 114, "cat" : {}},
            "health, wellness & beauty"         : {"id" : 63, "cat" : {
                "cosmetic products"             : {"id" : 163, "cat" : {}},
                "fitness equipment"             : {"id" : 164, "cat" : {}},
                "others"                        : {"id" : 178, "cat" : {}},
                "perfumes"                      : {"id" : 197, "cat" : {}},
                "salon items & equipment"       : {"id" : 165, "cat" : {}},
                "vitamins & food supplement"    : {"id" : 166, "cat" : {}}
            }},
            "household & industrial items"      : {"id" : 66, "cat" : {
                "cleaning materials"            : {"id" : 194, "cat" : {}},
                "furnitures & fixtures"         : {"id" : 170, "cat" : {}},
                "kitchenwares"                  : {"id" : 171, "cat" : {}},
                "machineries & equipment"       : {"id" : 172, "cat" : {}},
                "others"                        : {"id" : 179, "cat" : {}},
                "tools, generators & accessories"   : {"id" : 173, "cat" : {}}
            }},
            "medical supplies & equipment"      : {"id" : 106, "cat" : {}},
            "metals, woods glasses & stones"    : {"id" : 117, "cat" : {}},
            "musical instruments"               : {"id" : 101, "cat" : {}},
            "networking & telecommunications"   : {"id" : 183, "cat" : {}},
            "office & school supplies"          : {"id" : 107, "cat" : {}},
            "party needs"                       : {"id" : 182, "cat" : {}},
            "phones & accessories"              : {"id" : 141, "cat" : {}},
            "playthings and collectibles"       : {"id" : 108, "cat" : {}},
            "services"                          : {"id" : 67, "cat" : {
                "advertising and publishing"         : {"id" : 76, "cat" : {}},
                "animal services"                    : {"id" : 167, "cat" : {}},
                "arts & entertainment"               : {"id" : 110, "cat" : {}},
                "brokerage and investment"           : {"id" : 122, "cat" : {}},
                "clothing & textile services"        : {"id" : 86, "cat" : {}},
                "consulting"                         : {"id" : 121, "cat" : {}},
                "courier & logistics"                : {"id" : 124, "cat" : {}},
                "employment & human resources"       : {"id" : 123, "cat" : {}},
                "engineering services"               : {"id" : 79, "cat" : {}},
                "events & planning"                  : {"id" : 80, "cat" : {}},
                "food services"                      : {"id" : 168, "cat" : {}},
                "hair care"                          : {"id" : 198, "cat" : {}},
                "health & medical services"          : {"id" : 81, "cat" : {}},
                "information technology"             : {"id" : 82, "cat" : {}},
                "installation services"              : {"id" : 112, "cat" : {}},
                "landscaping services"               : {"id" : 111, "cat" : {}},
                "leisure & recreational activities"  : {"id" : 169, "cat" : {}},
                "loans & insurance"                  : {"id" : 83, "cat" : {}},
                "manufacturing & franchising"        : {"id" : 77, "cat" : {}},
                "marketing and sales"                : {"id" : 192, "cat" : {}},
                "massage services"                   : {"id" : 84, "cat" : {}},
                "memorial services"                  : {"id" : 85, "cat" : {}},
                "online business"                    : {"id" : 181, "cat" : {}},
                "other services"                     : {"id" : 105, "cat" : {}},
                "outsourcing & contracting"          : {"id" : 94, "cat" : {}},
                "rental services"                    : {"id" : 87, "cat" : {}},
                "repairs and maintenance"            : {"id" : 88, "cat" : {}},
                "souvenirs & giveaways"              : {"id" : 78, "cat" : {}},
                "tutorials, classes & workshops"     : {"id" : 89, "cat" : {}}
            }},
            "sports accessories & equipment"    : {"id" : 93, "cat" : {}},
            "travels and hotels"                : {"id" : 65, "cat" : {}},
            "other items"                       : {"id" : 91, "cat" : {}}
        }
    }
};

/* tourism category map v1.0 */
var catMapTourism = {
    'homepage' : {'url' : '/vigattintourism.com'},
    'destination' : {'url' : '/vigattintourism.com/tourism/destinations'},
    'articles' : {'url' : '/vigattintourism.com/tourism/articles?page=1'},
    'tourist spots' : {'url' : '/vigattintourism.com/tourism/tourist_spots'},
    'discussion' : {'url' : '/vigattintourism.com/tourism/discussion'},
    'directory' : {'url' : '/vigattintourism.com/tourism/destinations/91/directory'}
};

/* ads temp preview generator */
var tempPreview = new (function($){
    var previewLink;
    var adsContainer;

    this.init = init;

    function init() {
        previewLink = $('.ads-preview-link');
        adsContainer = $('.ads-frame');
        previewLink.unbind('click').click(function(e){onAdsLinkClick(e);});
    }

    function onAdsLinkClick(e) {
        saveAdsToBrowser();
    }

    function saveAdsToBrowser() {
        localStorage.tempAdsTitle = $('.ads-frame-title', adsContainer).text();
        localStorage.tempAdsPrice = $('.price-value', adsContainer).text();
        localStorage.tempAdsDescription = $('.ads-frame-description', adsContainer).text();
        localStorage.tempAdsImage = $('.ads-frame-image', adsContainer).attr('src');
        localStorage.tempAdsUrl = $('#ads-url').val();
    }
})(jQuery);

/* tools */
function getBase64Image(img) {
    var canvas = document.createElement("canvas");
    var newSize = sizeConverter(img.width, img.height, 320)
    canvas.width = newSize.width;
    canvas.height = newSize.height;

    var ctx = canvas.getContext("2d");
    ctx.drawImage(img, 0, 0, img.width, img.height, 0, 0, newSize.width, newSize.height);

    return canvas.toDataURL();
}

/**
 * Size converter
 * @param int $src_width
 * @param int $src_height
 * @param int $size_limit
 * @return array
 */
function sizeConverter(src_width, src_height, size_limit) {
    var new_size = {"width":src_width, "height":src_height};
    var new_width = 0;
    var new_height = 0;
    if(!size_limit) return new_size;
    if(src_width > src_height)
    {
        if(src_width < size_limit) new_width = src_width;
        else new_width = size_limit;
        new_height = (src_height/src_width)*new_width;
    }
    else
    {
        if(src_height < size_limit) new_height = src_height;
        else new_height = size_limit;
        new_width = (src_width/src_height)*new_height;
    }
    new_size = {"width":new_width, "height":new_height};
    return new_size;
}

/* Add comma to a number */
function addCommas(nStr) {
    nStr += '';
    x = nStr.split('.');
    x1 = x[0];
    x2 = x.length > 1 ? '.' + x[1] : '';
    var rgx = /(\d+)(\d{3})/;
    while (rgx.test(x1)) {
        x1 = x1.replace(rgx, '$1' + ',' + '$2');
    }
    return x1 + x2;
}

$(document).ready(function(e) {

    /* toggle hide show side menu */
    (function($) {
        $('[data-toggle=offcanvas]').click(function() {
            $('.row-offcanvas').toggleClass('active');
        });
    })(jQuery);

    /* ads image choose preview */
    var imageChooseEvent = new (function($) {
        var ratio = 0.66667;
        function resizeImage() {
            $('.ads-image-preview-container').height($('.ads-image-preview-container').width() * ratio);
        }
        this.resizeImage = function() {
            resizeImage();
        };
        $('#ads-choose-image-input').change(function(e) {
            var fileReader = new FileReader();
            var file = e.currentTarget.files;
            if(file[0].type.match('image.*')) {
                fileReader.onload = function(imageFile) {
                    var image = new Image();
                    image.src = imageFile.target.result;
                    $('#ads-image-data-url').val(getBase64Image(image));
                    $(image).addClass('ads-frame-image');
                    $('.ads-image-preview-container')
                        .html('')
                        .append(image)
                        .height($('.ads-image-preview-container').width() * ratio);

                    $(window).resize(function(e) {
                        $('.ads-image-preview-container').height($('.ads-image-preview-container').width() * ratio);
                    });
                }
                fileReader.readAsDataURL(file[0]);
            }
        });
        $('.ads-image-preview-container').css({'overflow':'hidden'}).height($('.ads-image-preview-container').width() * ratio);
        $(window).resize(function(e) {
            resizeImage();
        });
    })(jQuery);

    /* ads edit text */
    (function($) {
        var titleMaxChar = $('#ads-title').attr('data-max-char');
        var descriptionMaxChar = $('#ads-description').attr('data-max-char');
        function init() {
            var price = isNaN($('#ads-price').val()) ? 0 : $('#ads-price').val();
            if(price > 0) {
                $('.ads-frame .ads-frame-price').show();
                $('.ads-frame .ads-frame-price .price-value').text(parseFloat(price).toFixed(2));
                $('.ads-frame .price-value').text(addCommas($('.ads-frame .price-value').text()));
            }
            else {
                $('.ads-frame .ads-frame-price .price-value').text('');
                $('.ads-frame .ads-frame-price').hide();
            }
        }
        function textInputChange(sourceElement, targetElement, maxChar) {
            var text = $(sourceElement).val();
            $(targetElement).text(text.substr(0, maxChar));
        }
        $('#ads-title').keyup(function(e) {
            textInputChange($(e.currentTarget), $('.ads-frame .ads-frame-title'), titleMaxChar);
        }).change(function(e) {
            textInputChange($(e.currentTarget), $('.ads-frame .ads-frame-title'), titleMaxChar);
        });
        $('#ads-description').keyup(function(e) {
            textInputChange($(e.currentTarget), $('.ads-frame .ads-frame-description'), descriptionMaxChar);
        }).change(function(e){
            textInputChange($(e.currentTarget), $('.ads-frame .ads-frame-description'), descriptionMaxChar);
        });
        $('#ads-price').change(function(e) {
            var price = isNaN($(e.currentTarget).val()) ? 0 : $(e.currentTarget).val();
            if(price > 0) {
                $('.ads-frame .ads-frame-price').show();
                $('.ads-frame .ads-frame-price .price-value').text(parseFloat(price).toFixed(2));
                $('.ads-frame .price-value').text(addCommas($('.ads-frame .price-value').text()));
            }
            else {
                $('.ads-frame .ads-frame-price .price-value').text('');
                $('.ads-frame .ads-frame-price').hide();
            }
        });
        $('#ads-price').keyup(function(e) {
            var price = isNaN($(e.currentTarget).val()) ? 0 : $(e.currentTarget).val();
            if(price > 0) {
                $('.ads-frame .ads-frame-price').show();
                $('.ads-frame .ads-frame-price .price-value').text(parseFloat(price).toFixed(2));
                $('.ads-frame .price-value').text(addCommas($('.ads-frame .price-value').text()));
            }
            else {
                $('.ads-frame .ads-frame-price .price-value').text('');
                $('.ads-frame .ads-frame-price').hide();
            }
        });
        init();
    })(jQuery);

    /* tooltip */
    (function($) {
        $('.tooltip-enable-top').tooltip({"placement":"top"});
        $('.tooltip-enable-left').tooltip({"placement":"left"});
        $('.tooltip-enable-bottom').tooltip({"placement":"bottom"});
        $('.tooltip-enable-right').tooltip({"placement":"right"});
    })(jQuery);

    /* modal edit reserve views */
    (function($) {
        $('#addViewCredit').on('show.bs.modal', function(e) {
            $('.modal-current-reserve-view').html($('.remaining-views').text());
            var currentGold = parseFloat($('.current-gold').text());
            $('.modal-current-gold').html(currentGold.toFixed(2));
            $('.viewToGoldRate').html(viewToGoldRate);
            $('.modal-remaining-views').val($('.remaining-views').text());
        })
    })(jQuery);

    /* edit reserve views */
    (function($) {
        $('.views-remaining-progress').hide();
        $('.current-gold-progress').hide();
        $('#addViewCreditSave').click(function(e) {
            var views = $('.modal-remaining-views').val();
            var adsId = $('#adsId').val();
            $('#addViewCredit').modal('hide');
            $('.views-remaining-progress').show();
            $('.current-gold-progress').show();
            $.ajax( {
                type: 'POST',
                data: {"requestViews":views, "adsId":adsId},
                url: '/vigattinads/json-service/add-view-credit/post',
                dataType: 'json',
                beforeSend: function(jqXHR, settings) {
                },
                complete: function(jqXHR, textStatus) {
                    $('.views-remaining-progress').hide();
                    $('.current-gold-progress').hide();
                    if(textStatus != 'success') {
                        $('.alert-box').html('<div class="alert alert-danger fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><strong>Failed!</strong> Network error</div>');
                        $(".alert").alert();
                    }
                },
                success: function(data, textStatus, jqXHR) {
                    if(data.status == 'success') {
                        $('.current-gold').html(data.gold);
                        $('.remaining-views').html(data.views);
                        $('.current-gold-success').show().fadeOut(1000);
                        $('.views-remaining-success').show().fadeOut(1000);
                    }
                    else {
                        $('.alert-box').html('<div class="alert alert-danger fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><strong>'+data.status.charAt(0).toUpperCase()+data.status.slice(1)+'!</strong> '+data.reason.charAt(0).toUpperCase()+data.reason.slice(1)+'</div>');
                        $(".alert").alert();
                    }
                }
            });
        });
        setTimeout(function() {
            /* disabled auto hide alert box
            $(".alert.auto-hide").fadeOut(5000, function() {
                $(".alert.auto-hide").alert('close');
            })
            */
        }, 10000);
    })(jQuery);

    /* verify/filter */
    (function($){
        $('.allowed-number-only').keydown(function(e) {
            if ( $.inArray(e.which,[8,39,37]) !== -1) return;
            else if($(e.currentTarget).val().length > 6) return false;
            else {
                if (e.shiftKey || (e.which < 48 || e.which > 57) && (e.which < 96 || e.which > 105 )) {
                    return false;
                }
            }
        }).change(function(e) {
            var inputVal = parseInt($(e.currentTarget).val());
            if(isNaN(inputVal)) inputVal = 0;
            var goldResult = calculateCurrentGold(
                parseFloat($('.current-gold').text()),
                parseInt($('.modal-current-reserve-view').text()),
                inputVal,
                viewToGoldRate
            );
            $('.modal-current-gold').html(goldResult.toFixed(2));
            if((goldResult < 0) || inputVal == $('.modal-current-reserve-view').text()) $('.add-views-save-change').removeAttr('disabled').attr('disabled', 'disabled');
            else $('.add-views-save-change').removeAttr('disabled');
            if(goldResult < 0) $('.modal-current-gold').removeClass('text-danger').addClass('text-danger');
            else $('.modal-current-gold').removeClass('text-danger');
        }).keyup(function(e) {
            var inputVal = parseInt($(e.currentTarget).val());
            if(isNaN(inputVal)) inputVal = 0;
            var goldResult = calculateCurrentGold(
                parseFloat($('.current-gold').text()),
                parseInt($('.modal-current-reserve-view').text()),
                inputVal,
                viewToGoldRate
            );
            $('.modal-current-gold').html(goldResult.toFixed(2));
            if(goldResult < 0 || inputVal == $('.modal-current-reserve-view').text()) $('.add-views-save-change').removeAttr('disabled').attr('disabled', 'disabled');
            else $('.add-views-save-change').removeAttr('disabled');
            if(goldResult < 0) $('.modal-current-gold').removeClass('text-danger').addClass('text-danger');
            else $('.modal-current-gold').removeClass('text-danger');
        });

        function calculateCurrentGold(currentGold, currentReserve, newReserve, viewToGoldRate) {
            var viewChange = (currentReserve - newReserve) * viewToGoldRate;
            return currentGold + viewChange;
        }
    })(jQuery);

    /* ads form validate */
    (function($) {

        $("form button[type=submit]").click(function() {
            $("button[type=submit]", $(this).parents("form")).removeAttr("clicked");
            $(this).attr("clicked", "true");
        });

        function checkTitle() {
            //var reg = /^[a-zA-Z0-9_\s.\'"/,&()-]*$/;
            var min = 6;
            var max = 60;
            var invalidCharMsg = 'Title has invalid character';
            var lengthErrorMsg = 'Title must be minimum of '+min+' and maximum of '+max+' character';
            var formGroup = $('.ads-form-title');
            var value = $('input', formGroup).val();
            if(value.length > max || value.length < min) {
                formGroup.removeClass('has-error').addClass('has-error');
                $('.help-block', formGroup).html(lengthErrorMsg);
                return false;
            }
            /*
            if(!value.match(reg)) {
                formGroup.removeClass('has-error').addClass('has-error');
                $('.help-block', formGroup).html(invalidCharMsg);
                return false;
            }
            */
            formGroup.removeClass('has-error');
            $('.help-block', formGroup).html('');
            return true;
        }

        function checkUrl() {
            var reg = new RegExp('^(https?:\\/\\/)'+ // protocol
                '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|'+ // domain name
                '((\\d{1,3}\\.){3}\\d{1,3}))'+ // OR ip (v4) address
                '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+ // port and path
                '(\\?[;&a-z\\d%_.~+=-]*)?'+ // query string
                '(\\#[-a-z\\d_]*)?$','i'); // fragment locator;
            var min = 0;
            var max = 255;
            var invalidCharMsg = 'The link you provided is not a valid url';
            var lengthErrorMsg = 'Url must be maximum of '+max+' character';
            var formGroup = $('.ads-form-url');
            var value = $('input', formGroup).val();
            if(value.length > max || value.length < min) {
                formGroup.removeClass('has-error').addClass('has-error');
                $('.help-block', formGroup).html(lengthErrorMsg);
                return false;
            }
            if(!value.match(reg)) {
                formGroup.removeClass('has-error').addClass('has-error');
                $('.help-block', formGroup).html(invalidCharMsg);
                return false;
            }
            formGroup.removeClass('has-error');
            $('.help-block', formGroup).html('');
            return true;
        }

        function checkKeyword() {
            //var reg = /^[a-zA-Z0-9\s\,]*$/;
            var min = 0;
            var max = 512;
            var invalidCharMsg = 'Keyword has invalid character';
            var lengthErrorMsg = 'Keyword must be minimum of '+min+' and maximum of '+max+' character';
            var formGroup = $('.ads-form-keyword');
            var value = $('input', formGroup).val();
            if(value.length > max || value.length < min) {
                formGroup.removeClass('has-error').addClass('has-error');
                $('.help-block', formGroup).html(lengthErrorMsg);
                return false;
            }
            /*
            if(!value.match(reg)) {
                formGroup.removeClass('has-error').addClass('has-error');
                $('.help-block', formGroup).html(invalidCharMsg);
                return false;
            }
            */
            formGroup.removeClass('has-error');
            $('.help-block', formGroup).html('');
            return true;
        }

        function checkDescription() {
            //var reg = /^[a-zA-Z0-9_\s.\'"/,&()-]*$/;
            var min = 0;
            var max = 130;
            var invalidCharMsg = 'Description has invalid character';
            var lengthErrorMsg = 'Description must be minimum of '+min+' and maximum of '+max+' character';
            var formGroup = $('.ads-form-description');
            var value = $('textarea', formGroup).val();
            if(value.length > max || value.length < min) {
                formGroup.removeClass('has-error').addClass('has-error');
                $('.help-block', formGroup).html(lengthErrorMsg);
                return false;
            }
            /*
            if(!value.match(reg)) {
                formGroup.removeClass('has-error').addClass('has-error');
                $('.help-block', formGroup).html(invalidCharMsg);
                return false;
            }
            */
            formGroup.removeClass('has-error');
            $('.help-block', formGroup).html('');
            return true;
        }

        $('#ads-form').submit(function(e) {
            var submitVal = $("button[type=submit][clicked=true]", e.currentTarget).val();
            var err = 0;
            switch(submitVal)
            {
                case 'next':
                    if(!checkTitle()) err++;
                    if(!checkUrl()) err++;
                    if(!checkKeyword()) err++;
                    if(!checkDescription()) err++;
                    if(err) return false
                    break;
                case 'delete':
                    return false;
                    break;
            }
        });
    })(jQuery);

    /* modal ads confirm delete */
    (function($) {

    })(jQuery);

    /* modal account form */
    (function($) {
        $('.option-edit-account').click(function(e) {
            var tableRow = $('tr#'+$(e.currentTarget).attr('target-id'));
            $('#accountForm .form-control').val('');
            $('#accountForm .form-error').html('');
            $('#accountForm .dynamic-title').html('Edit Account');
            $('#accountForm .dynamic-title').html('Edit Account');
            $('#accountForm .account-form-progress').hide();
            $('#accountForm .submit-action').html('Update');
            $('#accountForm #inputEmail1').val($('.data-email', tableRow).text());
            $('#accountForm #inputUsername1').val($('.data-username', tableRow).text());
            $('#accountForm #inputFirstName1').val($('.data-first-name', tableRow).text());
            $('#accountForm #inputLastName1').val($('.data-last-name', tableRow).text());
            $('#accountForm #inputGold1').val($('.data-gold', tableRow).text());
            $('#accountForm #inputId1').val($(e.currentTarget).attr('target-id'));
            if($('.data-privilege', tableRow).text().indexOf('B') === -1) $('#accountForm #inputPrivilegeB1').prop('checked', false);
            else $('#accountForm #inputPrivilegeB1').removeAttr('checked').prop('checked', true);
            console.log($('.data-privilege', tableRow).text());
            if($('.data-privilege', tableRow).text().indexOf('A') === -1) $('#accountForm #inputPrivilegeA1').prop('checked', false);
            else $('#accountForm #inputPrivilegeA1').prop('checked', true);
            if($('.data-privilege', tableRow).text().indexOf('P') === -1) $('#accountForm #inputPrivilegeP1').prop('checked', false);
            else $('#accountForm #inputPrivilegeP1').prop('checked', true);
            $('#accountForm #inputDelete1').attr('target-id', $(e.currentTarget).attr('target-id'));
            $('#accountForm #inputDelete1').show();
        });

        $('.account-create-new').click(function(e) {
            $('#accountForm .form-control').val('');
            $('#accountForm .form-error').html('');
            $('#accountForm .submit-action').html('Create');
            $('#accountForm #inputPrivilegeB1').prop('checked', true);
            $('#accountForm #inputPrivilegeA1').prop('checked', false);
            $('#accountForm #inputPrivilegeP1').prop('checked', false);
            $('#accountForm #inputDelete1').hide();
        });
    })(jQuery);

    /* account form action */
    (function($) {
        $('#accountForm #inputSubmit1').click(function(e) {
            $(e.currentTarget).removeAttr('disabled').attr('disabled', 'disabled');
            var id = $('#accountForm #inputId1').val();
            var email = $('#accountForm #inputEmail1').val();
            var username = $('#accountForm #inputUsername1').val();
            var password = $('#accountForm #inputPassword1').val();
            var repeatPassword = $('#accountForm #inputRepeatPassword1').val();
            var firstName = $('#accountForm #inputFirstName1').val();
            var lastName = $('#accountForm #inputLastName1').val();
            var privilege = function() {
                var privilege = '';
                if($('#accountForm #inputPrivilegeB1').prop('checked')) privilege += 'B';
                if($('#accountForm #inputPrivilegeP1').prop('checked')) privilege += 'P';
                if($('#accountForm #inputPrivilegeA1').prop('checked')) privilege += 'A';
                return privilege;
            };
            var gold = $('#accountForm #inputGold1').val();
            var action = $('#accountForm #inputSubmit1').html();
            var actionUrl = (action.toLowerCase() == 'update') ? '/vigattinads/json-service/update-account/post' : '/vigattinads/json-service/create-account/post'
            var tableRow = (action.toLowerCase() == 'update') ? $('tr#'+id) : '';
            $.ajax( {
                type: 'POST',
                data: {
                    "id":id,
                    "email":email,
                    "username":username,
                    "password":password,
                    "repeatPassword": repeatPassword,
                    "firstName":firstName,
                    "lastName":lastName,
                    "privilege":privilege(),
                    "gold":gold
                },
                url: actionUrl,
                dataType: 'json',
                beforeSend: function(jqXHR, settings) {
                    $('#accountForm .account-form-progress').show();
                },
                complete: function(jqXHR, textStatus) {
                    $('#accountForm .account-form-progress').hide();
                    $(e.currentTarget).removeAttr('disabled');
                    if(textStatus != 'success') {

                    }
                },
                success: function(data, textStatus, jqXHR) {
                    if(data.status == 'success') {
                        $('#accountForm').modal('hide');
                        if(action.toLowerCase() == 'update') {
                            tableRow.css({'opacity':0});
                            $('.data-email', tableRow).html(email);
                            $('.data-username', tableRow).html(username);
                            $('.data-first-name', tableRow).html(firstName);
                            $('.data-last-name', tableRow).html(lastName);
                            $('.data-gold', tableRow).html(gold);
                            $('.data-privilege', tableRow).html(privilege());
                            tableRow.animate({'opacity':1}, 1000);
                        } else {
                            window.location = '/vigattinads/dashboard/admin/manageaccount';
                        }
                    }
                    else {
                        $('#accountForm .form-error').html('');
                        if(data.email) $('#accountForm .form-error.form-error-email').html('<small>'+data.email+'</small>');
                        if(data.username) $('#accountForm .form-error.form-error-username').html('<small>'+data.username+'</small>');
                        if(data.password) $('#accountForm .form-error.form-error-password').html('<small>'+data.password+'</small>');
                        if(data.repeatPassword) $('#accountForm .form-error.form-error-repeat-password').html('<small>'+data.repeatPassword+'</small>');
                        if(data.firstName) $('#accountForm .form-error.form-error-first-name').html('<small>'+data.firstName+'</small>');
                        if(data.lastName) $('#accountForm .form-error.form-error-last-name').html('<small>'+data.lastName+'</small>');
                    }
                }
            });
        });
        $('#accountForm #inputDelete1').click(function(e) {
            var id = $(e.currentTarget).attr('target-id');
            if(confirm('are you sure you want to delete this account?')) {
                window.location = '/vigattinads/dashboard/admin/manageaccount/delete/'+id;
            }
        });
    })(jQuery);

    /* on import ads modal shown */
    (function($) {
        var actionUrl = 'http://www.service.vigattin.com/vigattinads/dashboard/ads/import/';
        var Start = 0;
        var Name = '';
        var autoloadAdsImportList = $('.ads-import-list.auto-load');

        if(autoloadAdsImportList.length) {
            $('.import-ads-list-more-button').unbind('click').click(function(e) {
                getData(autoloadAdsImportList.attr('target-page'));
            });
            $('.import-ads-list-more-button').hide();
            getData(autoloadAdsImportList.attr('target-page'));
        }

        $('#importAdsModal').on('show.bs.modal', function(E) {
            Start = 0;
            Name = $(E.relatedTarget).attr('name');
            $('.ads-import-list', E.currentTarget).html('');
            $('.import-ads-list-more-button', E.currentTarget).unbind('click').click(function(e) {
                getData(Name);
            });
            $('.import-ads-list-more-button', E.currentTarget).hide();
        });

        $('#importAdsModal').on('shown.bs.modal', function(e) {
            getData(Name);
        });

        function getData(name) {
            $.ajax( {
                type: 'POST',
                data: {},
                url: actionUrl+name+'/'+Start,
                dataType: 'json',
                beforeSend: function(jqXHR, settings) {
                    $('.import-ads-list-progress').show();
                    $('.import-ads-list-more-button').hide();
                },
                complete: function(jqXHR, textStatus) {
                    if(textStatus != 'success') {
                    }
                },
                success: function(data, textStatus, jqXHR) {
                    $('.import-ads-list-progress').hide();
                    $.each(data.list, function(key, value) {
                        Start++;
                        var list =  '<li>' +
                                        '<div id="adsPanel'+Start+'" class="row ads-list-panel">'+
                                            '<div class="col-xs-3 image-frame"><img alt="ads image" onerror="this.src=\'/assets/vigattinads/img/no-image.jpg\';" src="'+$('<div/>').html(value.image).text()+'"></div>'+
                                            '<div class="col-xs-7">'+
                                                '<div class="title-container"><a class="ads-title" target="_blank" href="'+$('<div/>').html(value.url).text()+'">'+$('<div/>').html(value.title).text()+'</a></div>'+
                                                '<div class="price-container">Php <span class="ads-price">'+parseFloat(isNaN(value.price) ? 0 : value.price).toFixed(2)+'</span></div>'+
                                                '<div class="ads-description">'+$('<div/>').html(value.description).text()+'</div>'+
                                                '<input class="ads-keyword" type="hidden" value="'+$('<div/>').html('Homepage|'+decodeArrayCategory(value.category, '')).text()+'" />'+
                                            '</div>'+
                                            '<div class="col-xs-2"><a class="ads-import-single-button" data-target="#adsPanel'+Start+'" href="javascript:" data-dismiss="modal"><span class="glyphicon glyphicon-star"></span> Promote</a></div>'+
                                        '</div>'+
                                    '</li>';
                        $('.ads-import-list', e.currentTarget).append(list);
                    });
                    $('.ads-list-panel .ads-import-single-button').unbind('click').click(onImportSingleClick);
                    if(Start < data.total) $('.import-ads-list-more-button').show();
                }
            });
        }

        function onImportSingleClick(e) {
            var targetId = $(e.currentTarget).attr('data-target');
            var data = {
                title: $(targetId+' .ads-title').text(),
                image: $(targetId+' .image-frame img').attr('src'),
                description: $(targetId+' .ads-description').text(),
                price: $(targetId+' .ads-price').text(),
                url: $(targetId+' .ads-title').attr('href'),
                keyword: $(targetId+' .ads-keyword').val()
            };
            if(autoloadAdsImportList.length) {
                submitInfo(data.title, data.url, data.image, data.keyword, data.description, data.price);
                return
            }
            var ratio = 0.66667;
            var image = new Image();
            $('#ads-image-data-url').val(data.image);
            image.src = data.image;
            $(image).addClass('ads-frame-image');
            $('.ads-image-preview-container')
                .html('')
                .append(image)
                .height($('.ads-image-preview-container').width() * ratio);
            $('#ads-title').val(data.title);
            $('#ads-url').val(data.url);
            $('#ads-description').val(data.description);
            $('#ads-price').val(data.price);
            $('#ads-keyword').val(data.keyword);
            $('.ads-frame .ads-frame-title').text(data.title);
            $('.ads-frame .ads-frame-price .price-value').text(data.price);
            $('.ads-frame .ads-frame-description').text(data.description);
            $(window).resize(function(e) {
                $('.ads-image-preview-container').height($('.ads-image-preview-container').width() * ratio);
            });
            TradeCategory.init();
        }

        function submitInfo(adsTitle, adsUrl, adsImage, adsKeyword, adsDescription, adsPrice) {
            var form = $('<form method="post" action="/vigattinads/dashboard/ads/create/choose-website"></form>');
            form.append($('<input type="hidden" name="ads-title" value="'+adsTitle+'" />'));
            form.append($('<input type="hidden" name="ads-url" value="'+adsUrl+'" />'));
            form.append($('<input type="hidden" name="ads-image-data-url" value="'+adsImage+'" />'));
            form.append($('<input type="hidden" name="ads-keyword" value="'+adsKeyword+'"></input>'));
            form.append($('<input type="hidden" name="ads-description" value="'+adsDescription+'" />'));
            form.append($('<input type="hidden" name="ads-price" value="'+adsPrice+'" />'));
            form.append($('<input type="hidden" name="action" value="save-session" />'));
            $('body').append(form);
            form.submit();
        }

        function decodeArrayCategory(arrayCat, lastResult) {
            switch(typeof arrayCat) {
                case 'object':
                    $.each(arrayCat, function(key, value) {
                        lastResult += key+'|';
                        lastResult = decodeArrayCategory(value, lastResult);
                    });
                    break;
                case 'array':
                    $.each(arrayCat, function(key, value) {
                        lastResult += key+'|';
                        lastResult = decodeArrayCategory(value, lastResult);
                    });
                    break;
                default:
                    lastResult += arrayCat;
                    break;
            }
            return lastResult;
        }

    })(jQuery);

    /* trade category */
    var TradeCategory = new (function($) {
        var catList
        var tempKeyword = '';
        var keywordsInput;

        init();

        function init() {
            keywordsInput = $('#ads-keyword');
            catList = $('#tradeCategoryList');
            tempKeyword = $('#ads-temp-keyword').val();
            if(catList.length) {
                generateList(catList);
                onCheckChange(null);
                tempPreview.init();
            }
        }

        this.init = function(){init();}

        function convertKeyword(keyword) {
            var finalKeyword = '';
            var splitedKeyword = keyword.split('|');
            if(splitedKeyword) {
                $.each(splitedKeyword, function(key, value) {
                    finalKeyword += createAbsoluteCat(splitedKeyword, key);
                });
            }
            return [finalKeyword, splitedKeyword];
        }

        function createAbsoluteCat(splitedKeyword, position) {
            var absoluteCat = '';
            if(splitedKeyword.length && (position < splitedKeyword.length)) {
                for(var i = 0; i <= position; i++) {
                    absoluteCat += splitedKeyword[i]+' ';
                }
                absoluteCat = absoluteCat.replace(/^\s+|\s+$/gm,'');
                if(absoluteCat) absoluteCat = '('+absoluteCat+')';
            }
            return absoluteCat;
        }

        function generatePreviewUrl(splitedKeyword, position) {
            var mainUrl = '//www.vigattintrade.com/results/browse/';
            var currentMap;
            if(splitedKeyword.length && (position < splitedKeyword.length)) {
                $.each(splitedKeyword, function(key, value) {
                    if(key <= position) {
                        value = value.toLowerCase();
                        switch(key) {
                            case 0:
                                break;
                            case 1:
                                currentMap = catMap[value]['cat'];
                                mainUrl += catMap[value]['id']+'/';
                                break;
                            case 2:
                                mainUrl += currentMap[value]['id']+'/';
                                currentMap = currentMap[value]['cat'];
                                break;
                            case 3:
                                mainUrl += '?service='+currentMap[value]['id'];
                                break;
                        }
                    }
                });
            }
            return mainUrl;
        }

        function isCatChecked(splitedKeyword, position) {
            var keyword = $('#ads-keyword').val();
            var absCat = createAbsoluteCat(splitedKeyword, position);
            var regEx = new RegExp(absCat.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&"), 'g')
            if(keyword.match(regEx)) return true;
            return false;
        }

        function generateList() {
            var converted  = convertKeyword(tempKeyword);
            var checked = '';
            $.each(converted[1], function(key, value) {
                if(value) {
                    if(isCatChecked(converted[1], key)) checked = 'checked="checked"';
                    else checked = '';
                    catList.append('<li><a class="ads-preview-link" target="_blank" href="'+generatePreviewUrl(converted[1], key)+'#preview">preview</a> <input class="trade-cat-checkbox" data-pos="'+key+'" type="checkbox" '+checked+' style="margin-left: 10px" /> '+value+'</li>');
                }
            });
            if(!$('.trade-cat-checkbox:checked').length) {
                keywordsInput.val(converted[0]);
                $('.trade-cat-checkbox').attr('checked', 'checked');
            }
            $('.trade-cat-checkbox').unbind('change').change(onCheckChange);
        }

        function onCheckChange(e) {
            var converted  = convertKeyword(tempKeyword);
            var allAbsoluteKeyword = converted[0];
            $('.trade-cat-checkbox').each(function(key, value) {
                var checkBox =  $(value);
                var position = parseInt(checkBox.attr('data-pos'));
                if(!checkBox.is(":checked")) {
                    allAbsoluteKeyword = allAbsoluteKeyword.replace(createAbsoluteCat(converted[1], position), '');
                }
                if($('.trade-cat-checkbox:checked').length <= 1) {
                    $('.trade-cat-checkbox:checked').attr('disabled', 'disabled');
                }
                else $('.trade-cat-checkbox').removeAttr('disabled');
            });
            keywordsInput.val(allAbsoluteKeyword);
        }
    })(jQuery);

    /* input auto count character */
    (function($){
        var inputClass = '.countable-character';
        var maxCharAttr = 'data-max-char';
        var targetDisplayClassAttr = 'data-target-display';

        init();

        $(inputClass).keyup(function(e) {
            var max = $(e.currentTarget).attr(maxCharAttr);
            var output = $($(e.currentTarget).attr(targetDisplayClassAttr));
            var remaining = max - $(e.currentTarget).val().length;
            output.html('character(s) '+remaining);
            if(remaining > -1) {
                output.removeClass('text-danger');
            }
        });

        $(inputClass).keydown(function(e) {
            var max = $(e.currentTarget).attr(maxCharAttr);
            var output = $($(e.currentTarget).attr(targetDisplayClassAttr));
            var remaining = max - $(e.currentTarget).val().length;
            if(remaining < 1) {
                output.addClass('text-danger');
            }
        });

        function init() {
            $(inputClass).each(function(key, value) {
                var max = $(value).attr(maxCharAttr);
                var output = $($(value).attr(targetDisplayClassAttr));
                var remaining = max - $(value).val().length;
                output.html('character(s) '+remaining);
                output.removeClass('text-danger');
                if(remaining < 0) {
                    output.addClass('text-danger');
                }

            });
        }

    })(jQuery);

    /* tourism directory*/
    var TourismDirectory = new (function($) {
        var dirList;
        var keywordsInput;

        function init() {
            dirList = $('#tourismDirectoryList');
            keywordsInput = $('#ads-keyword');
            if(dirList.length) {
                generateList();
                if(!keywordsInput.val()) populateAbsolute();
                initCheckboxStatus();
                $('.tourism-cat-checkbox').unbind('change').change(onCheckboxClick);
                tempPreview.init();
            }
        }

        function populateAbsolute() {
            var keywordArray = getTempKeyword();
            keywordsInput.val(convertAllToAbsolute(keywordArray));
        }

        function generateList() {
            $.each(getTempKeyword(), function(key, value) {
                var category = catMapTourism[value.toLowerCase()];
                dirList.append('<li><a class="ads-preview-link" target="_blank" href="http:/'+category.url+'#preview">preview</a> <input class="tourism-cat-checkbox" type="checkbox" style="margin-left: 10px" value="'+value+'" /> '+value+'</li>');
            });
        }

        function initCheckboxStatus() {
            $('.tourism-cat-checkbox').each(function(key, value) {
                var regEx = new RegExp('\('+$(value).val()+'\)');
                if(keywordsInput.val().match(regEx)) {
                    $(value).attr('checked', 'checked');
                }
            });
        }

        function onCheckboxClick(e) {
            var keywordValue;
            var checkBoxes = $('.tourism-cat-checkbox');
            populateAbsolute();
            keywordValue = keywordsInput.val();
            checkBoxes.each(function(key, value) {
                var checkBox = $(value);
                if(!checkBox.is(":checked")) {
                    keywordValue = keywordValue.replace('('+checkBox.val()+')', '');
                }
            });
            keywordsInput.val(keywordValue);
            if($('.tourism-cat-checkbox:checked').length == 1) {
                $('.tourism-cat-checkbox:checked').attr('disabled', 'disabled');
            }
            else {
                checkBoxes.removeAttr('disabled');
            }
        }

        function getTempKeyword() {
            var tempKeyword = $('#ads-temp-keyword').val();
            return tempKeyword.split('|');
        }

        function convertToAbsolute(keyWordArray, postion) {
            return '('+keyWordArray[postion]+')';
        }

        function convertAllToAbsolute(keyWordArray, context) {
            var all = '';
            $.each(keyWordArray, function(key, value) {
                all += convertToAbsolute(keyWordArray, key);
            });
            return all;
        }

        init();
    })(jQuery);

    /* search form dropdown */
    (function($) {
        function init() {
            $('.search-form1 .dropdown-menu .item').click(function(e) {
                var category = $(e.currentTarget).text();
                $('.search-form1 .category-switch').html(category + ' <span class="caret">').val(category);
                $('.search-form1 .category-hidden-input').val(category);
            });
        }

        init();
    })(jQuery);

    /* admin manage ads */
    (function($) {
        var STATUS_DISAPPROVED = -1;
        var STATUS_PENDING = 0;
        var STATUS_APPROVED = 1;
        var STATUS_PAUSED = 2;
        var STATUS_REVIEWING = 3;
        var currentAdsId;

        function populateModal(currentView) {
            var clickedElement = $(currentView);
            var price = isNaN(clickedElement.attr('adsPrice')) ? 0 : clickedElement.attr('adsPrice');
            var image = $('<img />');
            image.load(function(e) {
                imageChooseEvent.resizeImage();})
                .attr('src', '/repo/'+clickedElement.attr('adsImage'))
                .addClass('ads-frame-image');
            currentAdsId = clickedElement.attr('adsId');
            $('.ads-frame .ads-frame-title').text(clickedElement.attr('adsTitle'));
            $('.ads-frame .ads-image-preview-container').html('').append(image);
            $('.ads-frame .ads-frame-description').text(clickedElement.attr('adsDescription'));
            if(price) {
                if(price > 0) {
                    $('.ads-frame .ads-frame-price').show();
                    $('.ads-frame .ads-frame-price .price-value').text(parseFloat(price).toFixed(2));
                }
                else {
                    $('.ads-frame .ads-frame-price .price-value').text('');
                    $('.ads-frame .ads-frame-price').hide();
                }
            }
            $('#adminAdsForm .status-radio').prop('checked', false);
            $('#adminAdsForm .status-radio.status'+clickedElement.attr('adsStatus')).prop('checked', true);
            if((clickedElement.attr('adsStatus') == STATUS_PENDING) || (clickedElement.attr('adsStatus') == STATUS_REVIEWING)) {
                $('.admin-change-status-container .status-apply').attr('disabled', 'disabled');
            }
            else {
                $('.admin-change-status-container .status-apply').removeAttr('disabled');
            }
        }

        function getHistory(adsId,start, limit) {
            $.ajax( {
                type: 'POST',
                data: {
                    "id":adsId,
                    "start":start,
                    "limit":limit
                },
                url: '/vigattinads/json-service/get-ads-history/post',
                dataType: 'json',
                beforeSend: function(jqXHR, settings) {
                    $('.ads-history-container .ads-history-control .account-form-progress').show();
                },
                complete: function(jqXHR, textStatus) {
                    $('.ads-history-container .ads-history-control .account-form-progress').hide();
                    if(textStatus != 'success') {}
                },
                success: function(data, textStatus, jqXHR) {
                    $.each(data, function(key, value) {
                        $('.ads-history-container .ads-history-log').append(value+'\n-\n');
                    });
                }
            });
        }

        function updateStatus(adsId, newStatus, reason) {
            $.ajax( {
                type: 'POST',
                data: {
                    "id":adsId,
                    "status":newStatus,
                    "reason":reason
                },
                url: '/vigattinads/json-service/ads-change-status/post',
                dataType: 'json',
                beforeSend: function(jqXHR, settings) {
                },
                complete: function(jqXHR, textStatus) {
                    //$('.admin-change-status-container .account-form-progress').hide();
                    //$('.admin-change-status-container .status-apply').show();
                    if(textStatus != 'success') {}
                },
                success: function(data, textStatus, jqXHR) {
                    window.location.reload();
                }
            });
        }

        function onApplyClick(e) {
            $(e.currentTarget).hide();
            $('.admin-change-status-container .account-form-progress').show();
            var status = $(e.currentTarget).val();
            var reason = $('.admin-change-status-container .status-reason').val();
            updateStatus(currentAdsId, status, reason);
        }

        $('.option-manage-ads').unbind('click').click(function(e) {
            $('.ads-history-container .ads-history-log').html('');
            populateModal(e.currentTarget);
            $('.admin-change-status-container .status-apply').unbind('click');
        });

        $('#adminAdsForm').on('shown.bs.modal', function(e) {
            imageChooseEvent.resizeImage();
            $('.admin-change-status-container .status-apply').click(function(e){onApplyClick(e);});
            getHistory(currentAdsId, 0, 30);
        });
    })(jQuery);
});






