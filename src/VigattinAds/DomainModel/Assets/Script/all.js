/* trade category map v1.0 */
var catMap = {
    "vehicles" : {
        "id" : 1,
        "cat" : {
            "all"                           : {"id" : "all", "cat" : {}},
            "car accessories & parts"       : {"id" : 5, "cat" : {
                "audio/video devices"           : {"id" : 44, "cat" : {}},
                "body & main parts"             : {"id" : 113, "cat" : {}},
                "braking systems"               : {"id" : 45, "cat" : {}},
                "car seats & interiors"         : {"id" : 92, "cat" : {}},
                "car-care"                      : {"id" : 46, "cat" : {}},
                "decorative"                    : {"id" : 47, "cat" : {}},
                "electrical & electronics"      : {"id" : 48, "cat" : {}},
                "engine components"             : {"id" : 99, "cat" : {}},
                "filtration systems"            : {"id" : 49, "cat" : {}},
                "for security & emergency"      : {"id" : 53, "cat" : {}},
                "lights and hid"                : {"id" : 50, "cat" : {}},
                "mags and tires"                : {"id" : 51, "cat" : {}},
                "mufflers"                      : {"id" : 102, "cat" : {}},
                "oils and lubricants"           : {"id" : 52, "cat" : {}},
                "others"                        : {"id" : 55, "cat" : {}},
                "suspension & steering systems" : {"id" : 54, "cat" : {}}

            }},
            "car services"                  : {"id" : 6, "cat" : {
                "airconditioning"               : {"id" : 27, "cat" : {}},
                "auto detaling"                 : {"id" : 29, "cat" : {}},
                "car insurance"                 : {"id" : 30, "cat" : {}},
                "car loans"                     : {"id" : 28, "cat" : {}},
                "others"                        : {"id" : 96, "cat" : {}},
                "repair and under chassis"      : {"id" : 26, "cat" : {}},
                "trucking"                      : {"id" : 31, "cat" : {}}

            }},
            "cars for rent"                 : {"id" : 68, "cat" : {}},
            "cars, sedans & minivans"       : {"id" : 1, "cat" : {}},
            "coupés & convertibles"         : {"id" : 39, "cat" : {}},
            "heavy equipment"               : {"id" : 143, "cat" : {}},
            "heavy equipment for rent"      : {"id" : 74, "cat" : {}},
            "hybrids & evs"                 : {"id" : 40, "cat" : {}},
            "luxury & sports cars"          : {"id" : 41, "cat" : {}},
            "motorcycle parts & acc"        : {"id" : 8, "cat" : {
                "audio"                         : {"id" : 98, "cat" : {}},
                "braking systems"               : {"id" : 97, "cat" : {}},
                "fairings"                      : {"id" : 59, "cat" : {}},
                "helmets and safety gears"      : {"id" : 56, "cat" : {}},
                "mags and tires"                : {"id" : 57, "cat" : {}},
                "mufflers"                      : {"id" : 58, "cat" : {}},
                "others"                        : {"id" : 95, "cat" : {}},
                "suspension system"             : {"id" : 103, "cat" : {}}
            }},
            "motorcycles & scooters"        : {"id" : 7, "cat" : {}},
            "suvs, crossovers & pickups"    : {"id" : 2, "cat" : {}},
            "trucks and buses for rent"     : {"id" : 69, "cat" : {}},
            "trucks, trailers & buses"      : {"id" : 4, "cat" : {}},
            "vans & rvs"                    : {"id" : 3, "cat" : {}},
            "other vehicles"                : {"id" : 104, "cat" : {}}
        }
    },
    "real estate" : {
        "id" : 2,
        "cat" : {
            "all"                           : {"id" : "all", "cat" : {}},
            "apartments & condos"           : {"id" : 9, "cat" : {}},
            "beaches & resorts"             : {"id" : 11, "cat" : {}},
            "commercial & industrial"       : {"id" : 12, "cat" : {}},
            "house & lots, townhouses"      : {"id" : 10, "cat" : {}},
            "lands & farms"                 : {"id" : 13, "cat" : {}},
            "memorial lot areas"            : {"id" : 14, "cat" : {}},
            "real estate services"          : {"id" : 15, "cat" : {
                "appraisals & brokerage"        : {"id" : 36, "cat" : {}},
                "architecture"                  : {"id" : 33, "cat" : {}},
                "contracting"                   : {"id" : 32, "cat" : {}},
                "interior designs"              : {"id" : 34, "cat" : {}},
                "landscape architecture"        : {"id" : 38, "cat" : {}},
                "others"                        : {"id" : 109, "cat" : {}}
            }},
            "rooms & bedspace for rent"     : {"id" : 75, "cat" : {}}
        }
    },
    "general category": {
        "id" : 4,
        "cat" : {
            "all"                               : {"id" : "all", "cat" : {}},
            "animals & pets"                    : {"id" : 64, "cat" : {
                "accessories"                   : {"id" : 125, "cat" : {}},
                "birds"                         : {"id" : 126 , "cat" : {}},
                "cats & dogs"                   : {"id" : 127 , "cat" : {}},
                "exotic"                        : {"id" : 128 , "cat" : {}},
                "fish"                          : {"id" : 129 , "cat" : {}},
                "livestock"                     : {"id" : 130 , "cat" : {}},
                "others"                        : {"id" : 131 , "cat" : {}}
            }},
            "appliances"                        : {"id" : 24, "cat" : {}},
            "arts & crafts"                     : {"id" : 119, "cat" : {}},
            "baby stuffs"                       : {"id" : 115, "cat" : {}},
            "books & other publications"        : {"id" : 175, "cat" : {}},
            "chemicals"                         : {"id" : 100, "cat" : {}},
            "computers & related items"         : {"id" : 116, "cat" : {
                "laptops & notebooks"           : {"id" : 134, "cat" : {}},
                "monitors"                      : {"id" : 196, "cat" : {}},
                "others"                        : {"id" : 180, "cat" : {}},
                "parts & accessories"           : {"id" : 135, "cat" : {}},
                "printers and scanners"         : {"id" : 195, "cat" : {}},
                "software"                      : {"id" : 136, "cat" : {}},
                "storage"                       : {"id" : 137, "cat" : {}}
            }},
            "electronics"                       : {"id" : 21, "cat" : {
                "audio & video"                 : {"id" : 138, "cat" : {}},
                "cameras"                       : {"id" : 139, "cat" : {}},
                "e-books"                       : {"id" : 142, "cat" : {}},
                "gadgets"                       : {"id" : 140, "cat" : {}},
                "others"                        : {"id" : 176, "cat" : {}}
            }},
            "farming & gardening"               : {"id" : 120, "cat" : {}},
            "food & related items"              : {"id" : 23, "cat" : {
                "cooking equipment"             : {"id" : 143, "cat" : {}},
                "drinks & beverages"            : {"id" : 144, "cat" : {}},
                "fruits & vegetables"           : {"id" : 147, "cat" : {}},
                "others"                        : {"id" : 150, "cat" : {}},
                "seafoods & meats"              : {"id" : 145, "cat" : {}},
                "seasoning & condiments"        : {"id" : 148, "cat" : {}},
                "snacks, desserts & delicacies" : {"id" : 149, "cat" : {}}

            }},
            "footwear, clothing & acc."         : {"id" : 25, "cat" : {
                "bags & wallets"                : {"id" : 151, "cat" : {}},
                "casual & formal wear"          : {"id" : 152, "cat" : {}},
                "costumes"                      : {"id" : 153, "cat" : {}},
                "gowns & dresses"               : {"id" : 154, "cat" : {}},
                "head & hair accessories"       : {"id" : 155, "cat" : {}},
                "jewelries & watches"           : {"id" : 156, "cat" : {}},
                "others"                        : {"id" : 177, "cat" : {}},
                "pants & jeans"                 : {"id" : 157, "cat" : {}},
                "shirts & blouses"              : {"id" : 159, "cat" : {}},
                "shoes, slippers & sandals"     : {"id" : 160, "cat" : {}},
                "shorts & skirts"               : {"id" : 161, "cat" : {}},
                "socks & stockings"             : {"id" : 158, "cat" : {}},
                "sportswear"                    : {"id" : 174, "cat" : {}},
                "undergarments"                 : {"id" : 162, "cat" : {}}
            }},
            "for security & emergency"          : {"id" : 114, "cat" : {}},
            "health, wellness & beauty"         : {"id" : 63, "cat" : {
                "cosmetic products"             : {"id" : 163, "cat" : {}},
                "fitness equipment"             : {"id" : 164, "cat" : {}},
                "others"                        : {"id" : 178, "cat" : {}},
                "perfumes"                      : {"id" : 197, "cat" : {}},
                "salon items & equipment"       : {"id" : 165, "cat" : {}},
                "vitamins & food supplement"    : {"id" : 166, "cat" : {}}
            }},
            "household & industrial items"      : {"id" : 66, "cat" : {
                "cleaning materials"            : {"id" : 194, "cat" : {}},
                "furnitures & fixtures"         : {"id" : 170, "cat" : {}},
                "kitchenwares"                  : {"id" : 171, "cat" : {}},
                "machineries & equipment"       : {"id" : 172, "cat" : {}},
                "others"                        : {"id" : 179, "cat" : {}},
                "tools, generators & accessories"   : {"id" : 173, "cat" : {}}
            }},
            "medical supplies & equipment"      : {"id" : 106, "cat" : {}},
            "metals, woods glasses & stones"    : {"id" : 117, "cat" : {}},
            "musical instruments"               : {"id" : 101, "cat" : {}},
            "networking & telecommunications"   : {"id" : 183, "cat" : {}},
            "office & school supplies"          : {"id" : 107, "cat" : {}},
            "party needs"                       : {"id" : 182, "cat" : {}},
            "phones & accessories"              : {"id" : 141, "cat" : {}},
            "playthings and collectibles"       : {"id" : 108, "cat" : {}},
            "services"                          : {"id" : 67, "cat" : {
                "advertising and publishing"         : {"id" : 76, "cat" : {}},
                "animal services"                    : {"id" : 167, "cat" : {}},
                "arts & entertainment"               : {"id" : 110, "cat" : {}},
                "brokerage and investment"           : {"id" : 122, "cat" : {}},
                "clothing & textile services"        : {"id" : 86, "cat" : {}},
                "consulting"                         : {"id" : 121, "cat" : {}},
                "courier & logistics"                : {"id" : 124, "cat" : {}},
                "employment & human resources"       : {"id" : 123, "cat" : {}},
                "engineering services"               : {"id" : 79, "cat" : {}},
                "events & planning"                  : {"id" : 80, "cat" : {}},
                "food services"                      : {"id" : 168, "cat" : {}},
                "hair care"                          : {"id" : 198, "cat" : {}},
                "health & medical services"          : {"id" : 81, "cat" : {}},
                "information technology"             : {"id" : 82, "cat" : {}},
                "installation services"              : {"id" : 112, "cat" : {}},
                "landscaping services"               : {"id" : 111, "cat" : {}},
                "leisure & recreational activities"  : {"id" : 169, "cat" : {}},
                "loans & insurance"                  : {"id" : 83, "cat" : {}},
                "manufacturing & franchising"        : {"id" : 77, "cat" : {}},
                "marketing and sales"                : {"id" : 192, "cat" : {}},
                "massage services"                   : {"id" : 84, "cat" : {}},
                "memorial services"                  : {"id" : 85, "cat" : {}},
                "online business"                    : {"id" : 181, "cat" : {}},
                "other services"                     : {"id" : 105, "cat" : {}},
                "outsourcing & contracting"          : {"id" : 94, "cat" : {}},
                "rental services"                    : {"id" : 87, "cat" : {}},
                "repairs and maintenance"            : {"id" : 88, "cat" : {}},
                "souvenirs & giveaways"              : {"id" : 78, "cat" : {}},
                "tutorials, classes & workshops"     : {"id" : 89, "cat" : {}}
            }},
            "sports accessories & equipment"    : {"id" : 93, "cat" : {}},
            "travels and hotels"                : {"id" : 65, "cat" : {}},
            "other items"                       : {"id" : 91, "cat" : {}}
        }
    }
};

/* tourism category map v1.0 */
var catMapTourism = {
    'homepage' : {'url' : '/vigattintourism.com'},
    'destinations' : {'url' : '/vigattintourism.com/tourism/destinations'},
    'articles' : {'url' : '/vigattintourism.com/tourism/articles?page=1'},
    'tourist spots' : {'url' : '/vigattintourism.com/tourism/tourist_spots'},
    'discussion' : {'url' : '/vigattintourism.com/tourism/discussion'},
    'directory' : {'url' : '/vigattintourism.com/tourism/destinations/91/directory'}
};

/* vigattin category map v1.0 */
var catMapVigattin = {
    'homepage' : {'url' : '/vigattin.com'}
};

/* ads temp preview generator */
var tempPreview = new (function($){
    var previewLink;
    var adsContainer;

    this.init = init;

    function init() {
        previewLink = $('.ads-preview-link');
        adsContainer = $('.ads-frame');
        previewLink.unbind('click').click(function(e){onAdsLinkClick(e);});
    }

    function onAdsLinkClick(e) {
        saveAdsToBrowser();
    }

    function saveAdsToBrowser() {
        var priceElement =  $('.price-value', adsContainer)[0];
        var titleElement =  $('.ads-frame-title', adsContainer)[0];
        var descriptionElement =  $('.ads-frame-description', adsContainer)[0];
        var imageElement =  $('.ads-frame-image', adsContainer)[0];
        var adsDate = $('.ads-frame-date').length ? $($('.ads-frame-date')[0]).text() : '';
        localStorage.tempAdsTitle = $(titleElement).text();
        localStorage.tempAdsPrice = $(priceElement).text();
        localStorage.tempAdsDescription = $(descriptionElement).text();
        localStorage.tempAdsImage = $(imageElement).attr('src');
        localStorage.tempAdsUrl = $('#ads-url').val();
        localStorage.tempAdsDate = adsDate;
    }
})(jQuery);

$(document).ready(function(e) {

    /* toggle hide show side menu */
    (function($) {
        $('[data-toggle=offcanvas]').click(function() {
            $('.row-offcanvas').toggleClass('active');
        });
    })(jQuery);

    /* ads image choose preview */
    var imageChooseEvent = new (function($) {
        var ratio = 0.66667;
        function resizeImage() {
            $('.ads-image-preview-container').each(function(key, element) {
                if($(element).hasClass('no-resize')) return;
                $(element).height($(element).width() * ratio);
            });
        }
        this.resizeImage = function() {
            resizeImage();
        };
        $('#ads-choose-image-input').change(function(e) {
            var fileReader = new FileReader();
            var file = e.currentTarget.files;
            if(file[0].type.match('image.*')) {
                fileReader.onload = function(imageFile) {
                    var image = new Image();
                    image.src = imageFile.target.result;
                    $('#ads-image-data-url').val(getBase64Image(image));
                    $(image).addClass('ads-frame-image');
                    $('.ads-image-preview-container')
                        .html('')
                        .append(image);
                    resizeImage();
                    $(window).resize(function(e) {
                        resizeImage();
                    });
                }
                fileReader.readAsDataURL(file[0]);
            }
        });
        $('.ads-image-preview-container').each(function(key, element) {
            if(!$(element).hasClass('no-resize')) {
                $(element).css({'overflow':'hidden'}).height($(element).width() * ratio);
            }
        });
        $('.modal').on('shown.bs.modal', function (e) {
            resizeImage();
        })
        $(window).resize(function(e) {
            resizeImage();
        });
    })(jQuery);

    /* ads edit text */
    (function($) {
        var titleMaxChar = $('#ads-title').attr('data-max-char');
        var descriptionMaxChar = $('#ads-description').attr('data-max-char');
        function init() {
            var price = isNaN($('#ads-price').val()) ? 0 : $('#ads-price').val();
            if(price > 0) {
                $('.ads-frame .ads-frame-price').show();
                $('.ads-frame .ads-frame-price .price-value').text(addCommas(parseFloat(price).toFixed(2)));
            }
            else {
                $('.ads-frame .ads-frame-price .price-value').text('');
                $('.ads-frame .ads-frame-price').hide();
            }
        }
        function textInputChange(sourceElement, targetElement, maxChar) {
            var text = $(sourceElement).val();
            $(targetElement).text(text.substr(0, maxChar));
        }
        $('#ads-title').keyup(function(e) {
            textInputChange($(e.currentTarget), $('.ads-frame .ads-frame-title'), titleMaxChar);
        }).change(function(e) {
            textInputChange($(e.currentTarget), $('.ads-frame .ads-frame-title'), titleMaxChar);
        });
        $('#ads-description').keyup(function(e) {
            textInputChange($(e.currentTarget), $('.ads-frame .ads-frame-description'), descriptionMaxChar);
        }).change(function(e){
            textInputChange($(e.currentTarget), $('.ads-frame .ads-frame-description'), descriptionMaxChar);
        });
        $('#ads-price').change(function(e) {
            var price = isNaN($(e.currentTarget).val()) ? 0 : $(e.currentTarget).val();
            if(price > 0) {
                $('.ads-frame .ads-frame-price').show();
                $('.ads-frame .ads-frame-price .price-value').text(addCommas(parseFloat(price).toFixed(2)));
            }
            else {
                $('.ads-frame .ads-frame-price .price-value').text('');
                $('.ads-frame .ads-frame-price').hide();
            }
        });
        $('#ads-price').keyup(function(e) {
            var price = isNaN($(e.currentTarget).val()) ? 0 : $(e.currentTarget).val();
            if(price > 0) {
                $('.ads-frame .ads-frame-price').show();
                $('.ads-frame .ads-frame-price .price-value').text(addCommas(parseFloat(price).toFixed(2)));
            }
            else {
                $('.ads-frame .ads-frame-price .price-value').text('');
                $('.ads-frame .ads-frame-price').hide();
            }
        });
        init();
    })(jQuery);

    /* tooltip */
    (function($) {
        $('.tooltip-enable-top').tooltip({"placement":"top"});
        $('.tooltip-enable-left').tooltip({"placement":"left"});
        $('.tooltip-enable-bottom').tooltip({"placement":"bottom"});
        $('.tooltip-enable-right').tooltip({"placement":"right"});
    })(jQuery);

    /* modal edit reserve views */
    (function($) {
        $('#addViewCredit').on('show.bs.modal', function(e) {
            $('.modal-current-reserve-view').html($('.remaining-views').text());
            var currentGold = parseFloat($('.current-gold').text());
            $('.modal-current-gold').html(currentGold.toFixed(2));
            $('.viewToGoldRate').html(viewToGoldRate);
            $('.modal-remaining-views').val($('.remaining-views').text());
        })
    })(jQuery);

    /* edit reserve views */
    (function($) {
        $('.views-remaining-progress').hide();
        $('.current-gold-progress').hide();
        $('#addViewCreditSave').click(function(e) {
            var views = $('.modal-remaining-views').val();
            var adsId = $('#adsId').val();
            $('#addViewCredit').modal('hide');
            $('.views-remaining-progress').show();
            $('.current-gold-progress').show();
            $.ajax( {
                type: 'POST',
                data: {"requestViews":views, "adsId":adsId},
                url: '/vigattinads/json-service/add-view-credit/post',
                dataType: 'json',
                beforeSend: function(jqXHR, settings) {
                },
                complete: function(jqXHR, textStatus) {
                    $('.views-remaining-progress').hide();
                    $('.current-gold-progress').hide();
                    if(textStatus != 'success') {
                        $('.alert-box').html('<div class="alert alert-danger fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><strong>Failed!</strong> Network error</div>');
                        $(".alert").alert();
                    }
                },
                success: function(data, textStatus, jqXHR) {
                    if(data.status == 'success') {
                        $('.current-gold').html(data.gold);
                        $('.remaining-views').html(data.views);
                        $('.current-gold-success').show().fadeOut(1000);
                        $('.views-remaining-success').show().fadeOut(1000);
                    }
                    else {
                        $('.alert-box').html('<div class="alert alert-danger fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><strong>'+data.status.charAt(0).toUpperCase()+data.status.slice(1)+'!</strong> '+data.reason.charAt(0).toUpperCase()+data.reason.slice(1)+'</div>');
                        $(".alert").alert();
                    }
                }
            });
        });
        setTimeout(function() {
            /* disabled auto hide alert box
             $(".alert.auto-hide").fadeOut(5000, function() {
             $(".alert.auto-hide").alert('close');
             })
             */
        }, 10000);
    })(jQuery);

    /* verify/filter */
    (function($){
        $('.allowed-number-only').keydown(function(e) {
            if ( $.inArray(e.which,[8,39,37]) !== -1) return;
            else if($(e.currentTarget).val().length > 6) return false;
            else {
                if (e.shiftKey || (e.which < 48 || e.which > 57) && (e.which < 96 || e.which > 105 )) {
                    return false;
                }
            }
        }).change(function(e) {
            var inputVal = parseInt($(e.currentTarget).val());
            if(isNaN(inputVal)) inputVal = 0;
            var goldResult = calculateCurrentGold(
                parseFloat($('.current-gold').text()),
                parseInt($('.modal-current-reserve-view').text()),
                inputVal,
                viewToGoldRate
            );
            $('.modal-current-gold').html(goldResult.toFixed(2));
            if((goldResult < 0) || inputVal == $('.modal-current-reserve-view').text()) $('.add-views-save-change').removeAttr('disabled').attr('disabled', 'disabled');
            else $('.add-views-save-change').removeAttr('disabled');
            if(goldResult < 0) $('.modal-current-gold').removeClass('text-danger').addClass('text-danger');
            else $('.modal-current-gold').removeClass('text-danger');
        }).keyup(function(e) {
            var inputVal = parseInt($(e.currentTarget).val());
            if(isNaN(inputVal)) inputVal = 0;
            var goldResult = calculateCurrentGold(
                parseFloat($('.current-gold').text()),
                parseInt($('.modal-current-reserve-view').text()),
                inputVal,
                viewToGoldRate
            );
            $('.modal-current-gold').html(goldResult.toFixed(2));
            if(goldResult < 0 || inputVal == $('.modal-current-reserve-view').text()) $('.add-views-save-change').removeAttr('disabled').attr('disabled', 'disabled');
            else $('.add-views-save-change').removeAttr('disabled');
            if(goldResult < 0) $('.modal-current-gold').removeClass('text-danger').addClass('text-danger');
            else $('.modal-current-gold').removeClass('text-danger');
        });

        function calculateCurrentGold(currentGold, currentReserve, newReserve, viewToGoldRate) {
            var viewChange = (currentReserve - newReserve) * viewToGoldRate;
            return currentGold + viewChange;
        }
    })(jQuery);

    /* ads form validate */
    (function($) {

        $("form button[type=submit]").click(function() {
            $("button[type=submit]", $(this).parents("form")).removeAttr("clicked");
            $(this).attr("clicked", "true");
        });

        function checkTitle() {
            //var reg = /^[a-zA-Z0-9_\s.\'"/,&()-]*$/;
            var min = 6;
            var max = 60;
            var invalidCharMsg = 'Title has invalid character';
            var lengthErrorMsg = 'Title must be minimum of '+min+' and maximum of '+max+' character';
            var formGroup = $('.ads-form-title');
            var value = $('input', formGroup).val();
            if(value.length > max || value.length < min) {
                formGroup.removeClass('has-error').addClass('has-error');
                $('.help-block', formGroup).html(lengthErrorMsg);
                return false;
            }
            /*
             if(!value.match(reg)) {
             formGroup.removeClass('has-error').addClass('has-error');
             $('.help-block', formGroup).html(invalidCharMsg);
             return false;
             }
             */
            formGroup.removeClass('has-error');
            $('.help-block', formGroup).html('');
            return true;
        }

        function checkUrl() {
            var reg = new RegExp('^(https?:\\/\\/)'+ // protocol
                '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|'+ // domain name
                '((\\d{1,3}\\.){3}\\d{1,3}))'+ // OR ip (v4) address
                '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+ // port and path
                '(\\?[;&a-z\\d%_.~+=-]*)?'+ // query string
                '(\\#[-a-z\\d_]*)?$','i'); // fragment locator;
            var min = 0;
            var max = 255;
            var invalidCharMsg = 'The link you provided is not a valid url';
            var lengthErrorMsg = 'Url must be maximum of '+max+' character';
            var formGroup = $('.ads-form-url');
            var value = $('input', formGroup).val();
            if(value.length > max || value.length < min) {
                formGroup.removeClass('has-error').addClass('has-error');
                $('.help-block', formGroup).html(lengthErrorMsg);
                return false;
            }
            if(!value.match(reg)) {
                formGroup.removeClass('has-error').addClass('has-error');
                $('.help-block', formGroup).html(invalidCharMsg);
                return false;
            }
            formGroup.removeClass('has-error');
            $('.help-block', formGroup).html('');
            return true;
        }

        function checkKeyword() {
            //var reg = /^[a-zA-Z0-9\s\,]*$/;
            var min = 0;
            var max = 512;
            var invalidCharMsg = 'Keyword has invalid character';
            var lengthErrorMsg = 'Keyword must be minimum of '+min+' and maximum of '+max+' character';
            var formGroup = $('.ads-form-keyword');
            var value = $('input', formGroup).val();
            if(value.length > max || value.length < min) {
                formGroup.removeClass('has-error').addClass('has-error');
                $('.help-block', formGroup).html(lengthErrorMsg);
                return false;
            }
            /*
             if(!value.match(reg)) {
             formGroup.removeClass('has-error').addClass('has-error');
             $('.help-block', formGroup).html(invalidCharMsg);
             return false;
             }
             */
            formGroup.removeClass('has-error');
            $('.help-block', formGroup).html('');
            return true;
        }

        function checkDescription() {
            //var reg = /^[a-zA-Z0-9_\s.\'"/,&()-]*$/;
            var min = 0;
            var max = 130;
            var invalidCharMsg = 'Description has invalid character';
            var lengthErrorMsg = 'Description must be minimum of '+min+' and maximum of '+max+' character';
            var formGroup = $('.ads-form-description');
            var value = $('textarea', formGroup).val();
            if(value.length > max || value.length < min) {
                formGroup.removeClass('has-error').addClass('has-error');
                $('.help-block', formGroup).html(lengthErrorMsg);
                return false;
            }
            /*
             if(!value.match(reg)) {
             formGroup.removeClass('has-error').addClass('has-error');
             $('.help-block', formGroup).html(invalidCharMsg);
             return false;
             }
             */
            formGroup.removeClass('has-error');
            $('.help-block', formGroup).html('');
            return true;
        }

        $('#ads-form').submit(function(e) {
            var submitVal = $("button[type=submit][clicked=true]", e.currentTarget).val();
            var err = 0;
            switch(submitVal)
            {
                case 'next':
                    if(!checkTitle()) err++;
                    if(!checkUrl()) err++;
                    //if(!checkKeyword()) err++;
                    if(!checkDescription()) err++;
                    if(err) return false
                    break;
                case 'delete':
                    return false;
                    break;
            }
        });
    })(jQuery);

    /* modal account form */
    (function($) {
        var start = 0;
        var limit = 10;
        var userId;

        function onLogScroll(e) {
            if(e.currentTarget.scrollHeight <= ((e.currentTarget.offsetHeight + e.currentTarget.scrollTop)+50)) {
                fetchLog();
            }
        }

        function fetchLog() {
            var historyLog = $('.history-log-wrapper');
            var loader = $('<div class="loader-container text-center"><img class=account-history-progress" src="/assets/vigattinads/img/circle-preloader-2.gif" /></div>');

            $.ajax( {
                type: 'POST',
                data: {
                    "id":userId,
                    "start":start,
                    "limit":limit
                },
                url: '/vigattinads/json-service/get-account-history/post',
                dataType: 'json',
                beforeSend: function(jqXHR, settings) {
                    historyLog.unbind('scroll');
                    $(loader).remove();
                    historyLog.append(loader);
                },
                complete: function(jqXHR, textStatus) {
                    $(loader).remove();
                    if(textStatus != 'success') {}
                },
                success: function(data, textStatus, jqXHR) {
                    if(!data.result.length) return;
                    $.each(data.result, function(key, value) {
                        var date = new Date(parseInt(value.timeCreated)*1000);
                        historyLog.append(date.toLocaleDateString()+' '+date.toLocaleTimeString()+'\n'+value.logMessage+'\n-\n');
                    });
                    if(data.result.length == limit) {
                        start += limit;
                        historyLog.scroll(function(e) {onLogScroll(e)});
                    }
                }
            });
        }

        $('.option-edit-account').click(function(e) {
            var tableRow = $('tr#'+$(e.currentTarget).attr('target-id'));
            userId = $(e.currentTarget).attr('target-id');
            $('#accountForm .form-control').val('');
            $('#accountForm .form-error').html('');
            $('#accountForm .dynamic-title').html('Edit Account');
            $('#accountForm .dynamic-title').html('Edit Account');
            $('#accountForm .account-form-progress').hide();
            $('#accountForm .submit-action').html('Update');
            $('#accountForm #inputEmail1').val($('.data-email', tableRow).text());
            $('#accountForm #inputUsername1').val($('.data-username', tableRow).text());
            $('#accountForm #inputFirstName1').val($('.data-first-name', tableRow).text());
            $('#accountForm #inputLastName1').val($('.data-last-name', tableRow).text());
            $('#accountForm #inputGold1').val($('.data-gold', tableRow).text());
            $('#accountForm #inputId1').val($(e.currentTarget).attr('target-id'));
            if($('.data-privilege', tableRow).text().indexOf('B') === -1) $('#accountForm #inputPrivilegeB1').prop('checked', false);
            else $('#accountForm #inputPrivilegeB1').removeAttr('checked').prop('checked', true);
            if($('.data-privilege', tableRow).text().indexOf('A') === -1) $('#accountForm #inputPrivilegeA1').prop('checked', false);
            else $('#accountForm #inputPrivilegeA1').prop('checked', true);
            if($('.data-privilege', tableRow).text().indexOf('P') === -1) $('#accountForm #inputPrivilegeP1').prop('checked', false);
            else $('#accountForm #inputPrivilegeP1').prop('checked', true);
            $('#accountForm #inputDelete1').attr('target-id', $(e.currentTarget).attr('target-id'));
            $('#accountForm #inputDelete1').show();
            $('.history-log-wrapper').html('');
            start = 0;
            fetchLog();
        });

        $('.account-create-new').click(function(e) {
            $('#accountForm .form-control').val('');
            $('#accountForm .form-error').html('');
            $('#accountForm .submit-action').html('Create');
            $('#accountForm #inputPrivilegeB1').prop('checked', true);
            $('#accountForm #inputPrivilegeA1').prop('checked', false);
            $('#accountForm #inputPrivilegeP1').prop('checked', false);
            $('#accountForm #inputDelete1').hide();
        });
    })(jQuery);

    /* account form action */
    (function($) {
        $('#accountForm #inputSubmit1').click(function(e) {
            $(e.currentTarget).removeAttr('disabled').attr('disabled', 'disabled');
            var id = $('#accountForm #inputId1').val();
            var email = $('#accountForm #inputEmail1').val();
            var username = $('#accountForm #inputUsername1').val();
            var password = $('#accountForm #inputPassword1').val();
            var repeatPassword = $('#accountForm #inputRepeatPassword1').val();
            var firstName = $('#accountForm #inputFirstName1').val();
            var lastName = $('#accountForm #inputLastName1').val();
            var privilege = function() {
                var privilege = '';
                if($('#accountForm #inputPrivilegeB1').prop('checked')) privilege += 'B';
                if($('#accountForm #inputPrivilegeP1').prop('checked')) privilege += 'P';
                if($('#accountForm #inputPrivilegeA1').prop('checked')) privilege += 'A';
                return privilege;
            };
            var gold = $('#accountForm #inputGold1').val();
            var action = $('#accountForm #inputSubmit1').html();
            var actionUrl = (action.toLowerCase() == 'update') ? '/vigattinads/json-service/update-account/post' : '/vigattinads/json-service/create-account/post'
            var tableRow = (action.toLowerCase() == 'update') ? $('tr#'+id) : '';
            $.ajax( {
                type: 'POST',
                data: {
                    "id":id,
                    "email":email,
                    "username":username,
                    "password":password,
                    "repeatPassword": repeatPassword,
                    "firstName":firstName,
                    "lastName":lastName,
                    "privilege":privilege(),
                    "gold":gold
                },
                url: actionUrl,
                dataType: 'json',
                beforeSend: function(jqXHR, settings) {
                    $('#accountForm .account-form-progress').show();
                },
                complete: function(jqXHR, textStatus) {
                    $('#accountForm .account-form-progress').hide();
                    $(e.currentTarget).removeAttr('disabled');
                    if(textStatus != 'success') {

                    }
                },
                success: function(data, textStatus, jqXHR) {
                    if(data.status == 'success') {
                        $('#accountForm').modal('hide');
                        if(action.toLowerCase() == 'update') {
                            tableRow.css({'opacity':0});
                            $('.data-email', tableRow).html(email);
                            $('.data-username', tableRow).html(username);
                            $('.data-first-name', tableRow).html(firstName);
                            $('.data-last-name', tableRow).html(lastName);
                            $('.data-gold', tableRow).html(gold);
                            $('.data-privilege', tableRow).html(privilege());
                            tableRow.animate({'opacity':1}, 1000);
                        } else {
                            window.location = '/vigattinads/dashboard/admin/manageaccount';
                        }
                    }
                    else {
                        $('#accountForm .form-error').html('');
                        if(data.email) $('#accountForm .form-error.form-error-email').html('<small>'+data.email+'</small>');
                        if(data.username) $('#accountForm .form-error.form-error-username').html('<small>'+data.username+'</small>');
                        if(data.password) $('#accountForm .form-error.form-error-password').html('<small>'+data.password+'</small>');
                        if(data.repeatPassword) $('#accountForm .form-error.form-error-repeat-password').html('<small>'+data.repeatPassword+'</small>');
                        if(data.firstName) $('#accountForm .form-error.form-error-first-name').html('<small>'+data.firstName+'</small>');
                        if(data.lastName) $('#accountForm .form-error.form-error-last-name').html('<small>'+data.lastName+'</small>');
                    }
                }
            });
        });
        $('#accountForm #inputDelete1').click(function(e) {
            var id = $(e.currentTarget).attr('target-id');
            if(confirm('are you sure you want to delete this account?')) {
                window.location = '/vigattinads/dashboard/admin/manageaccount/delete/'+id;
            }
        });
    })(jQuery);

    /* on import ads modal shown */
    (function($) {
        var actionUrl = 'http://www.service.vigattin.com/vigattinads/dashboard/ads/import/';
        var Start = 0;
        var Name = '';
        var autoloadAdsImportList = $('.ads-import-list.auto-load');

        if(typeof(importUrl) == 'undefined') importUrl = '';
        if(autoloadAdsImportList.length) {
            $('.import-ads-list-more-button').unbind('click').click(function(e) {
                getJsonpData();
            });
            $('.import-ads-list-more-button').hide();
            //getData(autoloadAdsImportList.attr('target-page'));
            getJsonpData();
        }

        $('#importAdsModal').on('show.bs.modal', function(E) {
            Start = 0;
            Name = $(E.relatedTarget).attr('name');
            $('.ads-import-list', E.currentTarget).html('');
            $('.import-ads-list-more-button', E.currentTarget).unbind('click').click(function(e) {
                getData(Name);
            });
            $('.import-ads-list-more-button', E.currentTarget).hide();
        });

        $('#importAdsModal').on('shown.bs.modal', function(e) {
            getData(Name);
        });

        function getData(name) {
            $.ajax( {
                type: 'POST',
                data: {},
                url: actionUrl+name+'/'+Start,
                dataType: 'json',
                beforeSend: function(jqXHR, settings) {
                    $('.import-ads-list-progress').show();
                    $('.import-ads-list-more-button').hide();
                },
                complete: function(jqXHR, textStatus) {
                    if(textStatus != 'success') {
                    }
                },
                success: function(data, textStatus, jqXHR) {
                    var totalList = data.list.length;
                    $('.import-ads-list-progress').hide();
                    $.each(data.list, function(key, value) {
                        Start++;
                        if((typeof value.price) == 'string') value.price = removeCommas(value.price);
                        var list =  '<li>' +
                            '<div id="adsPanel'+Start+'" class="row ads-list-panel">'+
                            '<div class="col-xs-3 image-frame"><img alt="ads image" onerror="this.src=\'/assets/vigattinads/img/no-image.jpg\';" src="'+$('<div/>').html(value.image).text()+'"></div>'+
                            '<div class="col-xs-7">'+
                            '<div class="title-container"><a class="ads-title" target="_blank" href="'+$('<div/>').html(value.url).text()+'">'+$('<div/>').html(value.title).text()+'</a></div>'+
                            '<div class="price-container">Php <span class="ads-price">'+parseFloat(isNaN(value.price) ? 0 : value.price).toFixed(2)+'</span></div>'+
                            '<div class="ads-description">'+$('<div/>').html(value.description).text()+'</div>'+
                            '<input class="ads-keyword" type="hidden" value="'+$('<div/>').html('Homepage|'+decodeArrayCategory(value.category, '')).text()+'" />'+
                            '<input class="ads-date" type="hidden" value="'+$('<div/>').html(value.date).text()+'" />'+
                            '</div>'+
                            '<div class="col-xs-2"><a class="ads-import-single-button" data-target="#adsPanel'+Start+'" href="javascript:" data-dismiss="modal"><span class="glyphicon glyphicon-star"></span> Promote</a></div>'+
                            '</div>'+
                            '</li>';
                        $('.ads-import-list', e.currentTarget).append(list);
                        if((key+1) < totalList) $('.ads-import-list', e.currentTarget).append('<hr>');
                    });
                    $('.ads-list-panel .ads-import-single-button').unbind('click').click(onImportSingleClick);
                    if(Start < data.total) $('.import-ads-list-more-button').show();
                }
            });
        }

        function getJsonpData() {
            var callback = 'callback';
            var offset = Start;
            var limit = 10;

            $.ajax( {
                type: 'POST',
                data: {},
                url: 'http://www.vigattintrade.com/adsservice?id='+vauthId+'&page=vigattintrade&offset='+offset+'&limit='+limit,
                dataType: 'jsonp',
                jsonp: callback,
                beforeSend: function(jqXHR, settings) {
                    $('.import-ads-list-progress').show();
                    $('.import-ads-list-more-button').hide();
                },
                complete: function(jqXHR, textStatus) {
                    if(textStatus != 'success') {
                    }
                },
                success: function(data, textStatus, jqXHR) {
                    var totalList = data.list.length;
                    $('.import-ads-list-progress').hide();
                    $.each(data.list, function(key, value) {
                        Start++;
                        if((typeof value.price) == 'string') value.price = removeCommas(value.price);
                        var list =  '<li>' +
                            '<div id="adsPanel'+Start+'" class="row ads-list-panel">'+
                            '<div class="col-xs-3 image-frame"><img alt="ads image" onerror="this.src=\'/assets/vigattinads/img/no-image.jpg\';" src="'+$('<div/>').html(value.image).text()+'"></div>'+
                            '<div class="col-xs-7">'+
                            '<div class="title-container"><a class="ads-title" target="_blank" href="'+$('<div/>').html(value.url).text()+'">'+$('<div/>').html(value.title).text()+'</a></div>'+
                            '<div class="price-container">Php <span class="ads-price">'+parseFloat(isNaN(value.price) ? 0 : value.price).toFixed(2)+'</span></div>'+
                            '<div class="ads-description">'+$('<div/>').html(value.description).text()+'</div>'+
                            '<input class="ads-keyword" type="hidden" value="'+$('<div/>').html('Homepage|'+decodeArrayCategory(value.category, '')).text()+'" />'+
                            '<input class="ads-date" type="hidden" value="'+$('<div/>').html(value.date).text()+'" />'+
                            '</div>'+
                            '<div class="col-xs-2"><a class="ads-import-single-button btn btn-default" data-target="#adsPanel'+Start+'" href="javascript:" data-dismiss="modal">Import</a></div>'+
                            '</div>'+
                            '</li>';
                        $('.ads-import-list', e.currentTarget).append(list);
                        if((key+1) < totalList) $('.ads-import-list', e.currentTarget).append('<hr>');
                    });
                    $('.ads-list-panel .ads-import-single-button').unbind('click').click(onImportSingleClick);
                    if(Start < data.total) $('.import-ads-list-more-button').show();
                }
            });
        }

        function onImportSingleClick(e) {
            var targetId = $(e.currentTarget).attr('data-target');
            var data = {
                title: $(targetId+' .ads-title').text(),
                image: $(targetId+' .image-frame img').attr('src'),
                description: $(targetId+' .ads-description').text(),
                price: $(targetId+' .ads-price').text(),
                url: $(targetId+' .ads-title').attr('href'),
                keyword: $(targetId+' .ads-keyword').val(),
                date: $(targetId+' .ads-date').val()
            };
            if(autoloadAdsImportList.length) {
                submitInfo(data.title, data.url, data.image, data.keyword, data.description, data.price, data.date);
                return
            }
            var ratio = 0.66667;
            var image = new Image();
            $('#ads-image-data-url').val(data.image);
            image.src = data.image;
            $(image).addClass('ads-frame-image');
            $('.ads-image-preview-container')
                .html('')
                .append(image)
                .height($('.ads-image-preview-container').width() * ratio);
            $('#ads-title').val(data.title);
            $('#ads-url').val(data.url);
            $('#ads-description').val(data.description);
            $('#ads-price').val(data.price);
            $('#ads-keyword').val(data.keyword);
            $('.ads-frame .ads-frame-title').text(data.title);
            $('.ads-frame .ads-frame-price .price-value').text(data.price);
            $('.ads-frame .ads-frame-description').text(data.description);
            $(window).resize(function(e) {
                $('.ads-image-preview-container').height($('.ads-image-preview-container').width() * ratio);
            });
            TradeCategory.init();
        }

        function submitInfo(adsTitle, adsUrl, adsImage, adsKeyword, adsDescription, adsPrice, date) {
            var form = $('<form method="post" action=""></form>');
            form.append($('<input type="hidden" name="ads-title" value="'+adsTitle+'" />'));
            form.append($('<input type="hidden" name="ads-url" value="'+adsUrl+'" />'));
            form.append($('<input type="hidden" name="ads-image-data-url" value="'+adsImage+'" />'));
            form.append($('<input type="hidden" name="ads-keyword" value="'+adsKeyword+'"></input>'));
            form.append($('<input type="hidden" name="ads-description" value="'+adsDescription+'" />'));
            form.append($('<input type="hidden" name="ads-price" value="'+adsPrice+'" />'));
            form.append($('<input type="hidden" name="ads-date" value="'+date+'" />'));
            form.append($('<input type="hidden" name="action" value="save-session" />'));
            form.append($('<input type="hidden" name="redirect-url" value="'+importUrl+'" />'));
            $('body').append(form);
            form.submit();
        }

        function decodeArrayCategory(arrayCat, lastResult) {
            switch(typeof arrayCat) {
                case 'object':
                    $.each(arrayCat, function(key, value) {
                        lastResult += key+'|';
                        lastResult = decodeArrayCategory(value, lastResult);
                    });
                    break;
                case 'array':
                    $.each(arrayCat, function(key, value) {
                        lastResult += key+'|';
                        lastResult = decodeArrayCategory(value, lastResult);
                    });
                    break;
                default:
                    lastResult += arrayCat;
                    break;
            }
            return lastResult;
        }

    })(jQuery);

    /* trade category */
    var TradeCategory = new (function($) {
        var catList
        var tempKeyword = '';
        var keywordsInput;

        init();

        function init() {
            keywordsInput = $('#ads-keyword');
            catList = $('#tradeCategoryList');
            tempKeyword = $('#ads-temp-keyword').val();
            if(catList.length) {
                generateList(catList);
                onCheckChange(null);
                tempPreview.init();
            }
        }

        this.init = function(){init();}

        function convertKeyword(keyword) {
            var finalKeyword = '';
            var splitedKeyword = keyword.split('|');
            if(splitedKeyword) {
                $.each(splitedKeyword, function(key, value) {
                    finalKeyword += createAbsoluteCat(splitedKeyword, key);
                });
            }
            return [finalKeyword, splitedKeyword];
        }

        function createAbsoluteCat(splitedKeyword, position) {
            var absoluteCat = '';
            if(splitedKeyword.length && (position < splitedKeyword.length)) {
                for(var i = 0; i <= position; i++) {
                    absoluteCat += splitedKeyword[i]+' ';
                }
                absoluteCat = absoluteCat.replace(/^\s+|\s+$/gm,'');
                if(absoluteCat) absoluteCat = '('+absoluteCat+')';
            }
            return absoluteCat;
        }

        function generatePreviewUrl(splitedKeyword, position) {
            var mainUrl = '//www.vigattintrade.com/results/browse/';
            var currentMap;
            if(splitedKeyword.length && (position < splitedKeyword.length)) {
                $.each(splitedKeyword, function(key, value) {
                    if(key <= position) {
                        value = value.toLowerCase();
                        switch(key) {
                            case 0:
                                break;
                            case 1:
                                currentMap = catMap[value]['cat'];
                                mainUrl += catMap[value]['id']+'/';
                                break;
                            case 2:
                                mainUrl += currentMap[value]['id']+'/';
                                currentMap = currentMap[value]['cat'];
                                break;
                            case 3:
                                mainUrl += '?service='+currentMap[value]['id'];
                                break;
                        }
                    }
                });
            }
            return mainUrl;
        }

        function isCatChecked(splitedKeyword, position) {
            var keyword = $('#ads-keyword').val();
            var absCat = createAbsoluteCat(splitedKeyword, position);
            var regEx = new RegExp(absCat.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&"), 'g')
            if(keyword.match(regEx)) return true;
            return false;
        }

        function generateList() {
            var converted  = convertKeyword(tempKeyword);
            var checked = '';
            $.each(converted[1], function(key, value) {
                if(value) {
                    if(isCatChecked(converted[1], key)) checked = 'checked="checked"';
                    else checked = '';
                    catList.append('<li><a class="ads-preview-link" target="_blank" href="'+generatePreviewUrl(converted[1], key)+'#preview">preview</a> <input class="trade-cat-checkbox" data-pos="'+key+'" type="checkbox" '+checked+' style="margin-left: 10px" /> '+((key == 0) ? 'All Category' : value)+'</li>');
                }
            });
            if(!$('.trade-cat-checkbox:checked').length) {
                keywordsInput.val(converted[0]);
                $('.trade-cat-checkbox').attr('checked', 'checked');
            }
            $('.trade-cat-checkbox').unbind('change').change(onCheckChange);
        }

        function onCheckChange(e) {
            var converted  = convertKeyword(tempKeyword);
            var allAbsoluteKeyword = converted[0];
            $('.trade-cat-checkbox').each(function(key, value) {
                var checkBox =  $(value);
                var position = parseInt(checkBox.attr('data-pos'));
                if(!checkBox.is(":checked")) {
                    allAbsoluteKeyword = allAbsoluteKeyword.replace(createAbsoluteCat(converted[1], position), '');
                }
                if($('.trade-cat-checkbox:checked').length <= 1) {
                    $('.trade-cat-checkbox:checked').attr('disabled', 'disabled');
                }
                else $('.trade-cat-checkbox').removeAttr('disabled');
            });
            keywordsInput.val(allAbsoluteKeyword);
        }
    })(jQuery);

    /* must have one checked */
    (function($){
        function validateCheckbox() {
            var totalChecked = 0;
            $('.must-have-one-checked:enabled').each(function(key, element) {
                if($(element).is(':checked')) totalChecked++;
            });
            return totalChecked;
        }
        $('.must-have-one-checked:enabled').change(function(e) {
            if(!validateCheckbox()) $(e.currentTarget).prop('checked', true);
        });
        validateCheckbox();
    })(jQuery);

    /* input auto count character */
    (function($){
        var inputClass = '.countable-character';
        var maxCharAttr = 'data-max-char';
        var targetDisplayClassAttr = 'data-target-display';

        init();

        $(inputClass).keyup(function(e) {
            var max = $(e.currentTarget).attr(maxCharAttr);
            var output = $($(e.currentTarget).attr(targetDisplayClassAttr));
            var remaining = max - $(e.currentTarget).val().length;
            output.html('character(s) '+remaining);
            if(remaining > -1) {
                output.removeClass('text-danger');
            }
        });

        $(inputClass).keydown(function(e) {
            var max = $(e.currentTarget).attr(maxCharAttr);
            var output = $($(e.currentTarget).attr(targetDisplayClassAttr));
            var remaining = max - $(e.currentTarget).val().length;
            if(remaining < 1) {
                output.addClass('text-danger');
            }
        });

        $(inputClass).change(function(e) {
            var max = $(e.currentTarget).attr(maxCharAttr);
            var output = $($(e.currentTarget).attr(targetDisplayClassAttr));
            var remaining = max - $(e.currentTarget).val().length;
            output.html('character(s) '+remaining);
            if(remaining > -1) {
                output.removeClass('text-danger');
            }
        });

        function init() {
            $(inputClass).each(function(key, value) {
                var max = $(value).attr(maxCharAttr);
                var output = $($(value).attr(targetDisplayClassAttr));
                var remaining = max - $(value).val().length;
                output.html('character(s) '+remaining);
                output.removeClass('text-danger');
                if(remaining < 0) {
                    output.addClass('text-danger');
                }

            });
        }

    })(jQuery);

    /* tourism directory*/
    var TourismDirectory = new (function($) {
        var dirList;
        var keywordsInput;

        function init() {
            dirList = $('#tourismDirectoryList');
            keywordsInput = $('#ads-keyword');
            if(dirList.length) {
                generateList();
                if(!keywordsInput.val()) populateAbsolute();
                initCheckboxStatus();
                $('.tourism-cat-checkbox').unbind('change').change(onCheckboxClick);
                tempPreview.init();
            }
        }

        function populateAbsolute() {
            var keywordArray = getTempKeyword();
            keywordsInput.val(convertAllToAbsolute(keywordArray));
        }

        function generateList() {
            $.each(getTempKeyword(), function(key, value) {
                var category = catMapTourism[value.toLowerCase()];
                dirList.append('<li><a class="ads-preview-link" target="_blank" href="http:/'+category.url+'#preview">preview</a> <input class="tourism-cat-checkbox" type="checkbox" style="margin-left: 10px" value="'+value+'" /> '+value+'</li>');
            });
        }

        function initCheckboxStatus() {
            $('.tourism-cat-checkbox').each(function(key, value) {
                var regEx = new RegExp('\('+$(value).val()+'\)');
                if(keywordsInput.val().match(regEx)) {
                    $(value).attr('checked', 'checked');
                }
            });
        }

        function onCheckboxClick(e) {
            var keywordValue;
            var checkBoxes = $('.tourism-cat-checkbox');
            populateAbsolute();
            keywordValue = keywordsInput.val();
            checkBoxes.each(function(key, value) {
                var checkBox = $(value);
                if(!checkBox.is(":checked")) {
                    keywordValue = keywordValue.replace('('+checkBox.val()+')', '');
                }
            });
            keywordsInput.val(keywordValue);
            if($('.tourism-cat-checkbox:checked').length == 1) {
                $('.tourism-cat-checkbox:checked').attr('disabled', 'disabled');
            }
            else {
                checkBoxes.removeAttr('disabled');
            }
        }

        function getTempKeyword() {
            var tempKeyword = $('#ads-temp-keyword').val();
            return tempKeyword.split('|');
        }

        function convertToAbsolute(keyWordArray, postion) {
            return '('+keyWordArray[postion]+')';
        }

        function convertAllToAbsolute(keyWordArray, context) {
            var all = '';
            $.each(keyWordArray, function(key, value) {
                all += convertToAbsolute(keyWordArray, key);
            });
            return all;
        }

        init();
    })(jQuery);

    /* vigattin directory*/
    var TourismDirectory = new (function($) {
        var dirList;
        var keywordsInput;

        function init() {
            dirList = $('#vigattinDirectoryList');
            keywordsInput = $('#ads-keyword');
            if(dirList.length) {
                generateList();
                if(!keywordsInput.val()) populateAbsolute();
                initCheckboxStatus();
                $('.tourism-cat-checkbox').unbind('change').change(onCheckboxClick);
                tempPreview.init();
                onCheckboxClick(e);
            }
        }

        function populateAbsolute() {
            var keywordArray = getTempKeyword();
            keywordsInput.val(convertAllToAbsolute(keywordArray));
        }

        function generateList() {
            $.each(getTempKeyword(), function(key, value) {
                var category = catMapVigattin[value.toLowerCase()];
                dirList.append('<li><a class="ads-preview-link" target="_blank" href="http:/'+category.url+'#preview">preview</a> <input class="tourism-cat-checkbox" type="checkbox" style="margin-left: 10px" value="'+value+'" /> '+value+'</li>');
            });
        }

        function initCheckboxStatus() {
            $('.tourism-cat-checkbox').each(function(key, value) {
                var regEx = new RegExp('\('+$(value).val()+'\)');
                if(keywordsInput.val().match(regEx)) {
                    $(value).attr('checked', 'checked');
                }
            });
        }

        function onCheckboxClick(e) {
            var keywordValue;
            var checkBoxes = $('.tourism-cat-checkbox');
            populateAbsolute();
            keywordValue = keywordsInput.val();
            checkBoxes.each(function(key, value) {
                var checkBox = $(value);
                if(!checkBox.is(":checked")) {
                    keywordValue = keywordValue.replace('('+checkBox.val()+')', '');
                }
            });
            keywordsInput.val(keywordValue);
            if($('.tourism-cat-checkbox:checked').length == 1) {
                $('.tourism-cat-checkbox:checked').attr('disabled', 'disabled');
            }
            else {
                checkBoxes.removeAttr('disabled');
            }
        }

        function getTempKeyword() {
            var tempKeyword = $('#ads-temp-keyword').val();
            return tempKeyword.split('|');
        }

        function convertToAbsolute(keyWordArray, postion) {
            return '('+keyWordArray[postion]+')';
        }

        function convertAllToAbsolute(keyWordArray, context) {
            var all = '';
            $.each(keyWordArray, function(key, value) {
                all += convertToAbsolute(keyWordArray, key);
            });
            return all;
        }

        init();
    })(jQuery);

    /* search form dropdown */
    (function($) {
        function init() {
            $('.search-form1 .dropdown-menu .item').click(function(e) {
                var category = $(e.currentTarget).text();
                $('.search-form1 .category-switch').html(category + ' <span class="caret">').val(category);
                $('.search-form1 .category-hidden-input').val(category);
            });
        }

        init();
    })(jQuery);

    /* admin manage ads */
    (function($) {
        var STATUS_DISAPPROVED = -1;
        var STATUS_PENDING = 0;
        var STATUS_APPROVED = 1;
        var STATUS_PAUSED = 2;
        var STATUS_REVIEWING = 3;
        var currentAdsId;

        function populateModal(currentView) {
            var clickedElement = $(currentView);
            var price = isNaN(clickedElement.attr('adsPrice')) ? 0 : clickedElement.attr('adsPrice');
            var image = $('<img />');
            image.load(function(e) {
                imageChooseEvent.resizeImage();})
                .attr('src', '/repo/'+clickedElement.attr('adsImage'))
                .addClass('ads-frame-image');
            currentAdsId = clickedElement.attr('adsId');
            $('.ads-frame .ads-frame-title').text(clickedElement.attr('adsTitle'));
            $('.ads-frame .ads-image-preview-container').html('').append(image);
            $('.ads-frame .ads-frame-description').text(clickedElement.attr('adsDescription'));
            if(price) {
                if(price > 0) {
                    $('.ads-frame .ads-frame-price').show();
                    $('.ads-frame .ads-frame-price .price-value').text(parseFloat(price).toFixed(2));
                }
                else {
                    $('.ads-frame .ads-frame-price .price-value').text('');
                    $('.ads-frame .ads-frame-price').hide();
                }
            }
            $('#adminAdsForm .status-radio').prop('checked', false);
            $('#adminAdsForm .status-radio.status'+clickedElement.attr('adsStatus')).prop('checked', true);

            $('.admin-change-status-container .status-apply').removeAttr('disabled');

            switch(parseInt(clickedElement.attr('adsStatus'))) {
                case STATUS_PENDING:
                    $('.admin-change-status-container .status-apply.pending').attr('disabled', 'disabled');
                    break;
                case STATUS_APPROVED:
                    $('.admin-change-status-container .status-apply.approved').attr('disabled', 'disabled');
                    break;
                case STATUS_DISAPPROVED:
                    $('.admin-change-status-container .status-apply.disapproved').attr('disabled', 'disabled');
                    break;
            }
        }

        function getHistory(adsId,start, limit) {
            $.ajax( {
                type: 'POST',
                data: {
                    "id":adsId,
                    "start":start,
                    "limit":limit
                },
                url: '/vigattinads/json-service/get-ads-history/post',
                dataType: 'json',
                beforeSend: function(jqXHR, settings) {
                    $('.ads-history-container .ads-history-control .account-form-progress').show();
                },
                complete: function(jqXHR, textStatus) {
                    $('.ads-history-container .ads-history-control .account-form-progress').hide();
                    if(textStatus != 'success') {}
                },
                success: function(data, textStatus, jqXHR) {
                    $.each(data, function(key, value) {
                        $('.ads-history-container .ads-history-log').append(value+'\n-\n');
                    });
                }
            });
        }

        function updateStatus(adsId, newStatus, reason) {
            $.ajax( {
                type: 'POST',
                data: {
                    "id":adsId,
                    "status":newStatus,
                    "reason":reason
                },
                url: '/vigattinads/json-service/ads-change-status/post',
                dataType: 'json',
                beforeSend: function(jqXHR, settings) {
                },
                complete: function(jqXHR, textStatus) {
                    //$('.admin-change-status-container .account-form-progress').hide();
                    //$('.admin-change-status-container .status-apply').show();
                    if(textStatus != 'success') {}
                },
                success: function(data, textStatus, jqXHR) {
                    window.location.reload();
                }
            });
        }

        function onApplyClick(e) {
            $('.status-apply').hide();
            $('.admin-change-status-container .account-form-progress').show();
            var status = $(e.currentTarget).val();
            var reason = $('.admin-change-status-container .status-reason').val();
            updateStatus(currentAdsId, status, reason);
        }

        $('.option-manage-ads').unbind('click').click(function(e) {
            $('.ads-history-container .ads-history-log').html('');
            populateModal(e.currentTarget);
            $('.admin-change-status-container .status-apply').unbind('click');
        });

        $('#adminAdsForm').on('shown.bs.modal', function(e) {
            imageChooseEvent.resizeImage();
            $('.admin-change-status-container .status-apply').click(function(e){onApplyClick(e);});
            getHistory(currentAdsId, 0, 30);
        });
    })(jQuery);

    /* Views inline update v2.0 */
    (function($){
        function init() {
            $('.ads-view-limit-inline-edit').on('show.bs.popover', function (e){onPopupShow(e);});
            $('.ads-view-limit-inline-edit').on('shown.bs.popover', function (e){onPopupShown(e);});
            iniPopover();
        }

        function iniPopover() {
            $('.ads-view-limit-inline-edit').popover({
                'html':true
            });
        }

        function onPopupShow(e) {
            $('.ads-view-limit-inline-edit').popover('hide');
        }

        function onPopupShown(e) {
            var targetId = $(e.currentTarget).attr('data-target-id');
            var popOver = $('#adsViewInlineEdit'+targetId);
            var currentGold = $('.current-gold').text();
            var currentReserve = $('#reserve'+targetId+' .reserve-value').text();
            $('.inline-edit-gold', popOver).html(currentGold);
            $('.inline-edit-input', popOver).val(currentReserve);
            $('.inline-edit-cancel', popOver).unbind('click').click(function(e){onCancel(e, popOver)});
            $('.inline-edit-apply', popOver).unbind('click').click(function(e){onApply(e, popOver)});
            $('.inline-edit-input', popOver).unbind('change').change(function(e){onChange(e, popOver)});
            $('.inline-edit-input', popOver).unbind('keyup').keyup(function(e){onKeyup(e, popOver)});
        }

        function onCancel(e, popOver) {
            $('.ads-view-limit-inline-edit').popover('hide');
        }

        function onApply(e, popOver) {
            apiChangeReserve($('.inline-edit-input', popOver).val(), popOver.attr('data-target-id'), $('#reserve'+popOver.attr('data-target-id')));
            $('.ads-view-limit-inline-edit').popover('hide');
        }

        function onChange(e, popOver) {
            var targetId = popOver.attr('data-target-id');
            var currentReserve = $('#reserve'+targetId+' .reserve-value').text();
            var inputValue = $(e.currentTarget).val();
            var currentGold = parseFloat($('.current-gold').text());
            var newGold = parseFloat(currentGold - ((inputValue - currentReserve) * viewToGoldRate));
            $('.inline-edit-gold', popOver).text(newGold.toFixed(2));
        }

        function onKeyup(e, popOver) {
            var targetId = popOver.attr('data-target-id');
            var currentReserve = $('#reserve'+targetId+' .reserve-value').text();
            var inputValue = $(e.currentTarget).val();
            var currentGold = parseFloat($('.current-gold').text());
            var newGold = parseFloat(currentGold - ((inputValue - currentReserve) * viewToGoldRate));
            $('.inline-edit-gold', popOver).text(newGold.toFixed(2));
        }

        function apiChangeReserve(newReserve, adsId, currentViewElement) {
            $.ajax( {
                type: 'POST',
                data: {"requestViews":newReserve, "adsId":adsId},
                url: '/vigattinads/json-service/add-view-credit/post',
                dataType: 'json',
                beforeSend: function(jqXHR, settings) {
                    $('.reserve-value', currentViewElement).text(newReserve);
                },
                complete: function(jqXHR, textStatus) {
                    if(textStatus != 'success') {
                    }
                },
                success: function(data, textStatus, jqXHR) {
                    if(data.status == 'success') {
                        $('.current-gold').html(data.gold);
                        $('.current-gold-success').show().fadeOut(1000);
                        $('.reserve-value', currentViewElement).text(data.views);
                    }
                    else {
                        $('.alert-box').html('<div class="alert alert-danger fade in"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><strong>'+data.status.charAt(0).toUpperCase()+data.status.slice(1)+'!</strong> '+data.reason.charAt(0).toUpperCase()+data.reason.slice(1)+'</div>');
                        $(".alert").alert();
                    }
                }
            });
        }

        init();
    })(jQuery);

    /* activate preview link */
    tempPreview.init();

    /* disable drop down menu item toggle close, add this class to drop down menu ul (disable-toggle) */
    $('.dropdown-menu').on('click', function(e){
        if($(this).hasClass('disable-toggle')){
            e.stopPropagation();
        }
    });

    /* table tourism author list jsonP fetcher */
    (function($) {
        var actionUrl = 'http://www.vigattintourism.com/service/author';
        var tableBody = $('#authorSearchTable');
        var tableFootTr = $('#authorSearchTablePreloader');
        var SubmitButton = $('#authorSearchSubmit');
        var stringInput = $('#authorSearchString');
        var categoryInput = $('.authorSearchCategories');
        var searchString = '';
        var filter = '';
        var offset = 0;
        var limit = 10;
        var fetching = false;
        var ajax;
        var isLast = false;
        var multiSelectorBox = $('.multi-selector-box');
        var mainBox = $('.box-container');
        var mainBoxOffset
        var itemLimit = 10;

        function init() {
            if(!multiSelectorBox.length) return;
            updateMainBoxSize();
            hideItemBoxIfEmpty();
            $(document).scroll(onLogScroll);
            SubmitButton.click(onSubmit);
            fetchMore();
            $(window).resize(function(){
                updateMainBoxSize();
                fixedIfScrolled();
            });
        }

        function updateMainBoxSize() {
            var containerWidth = mainBox.parent().width();
            mainBox.css({'width':containerWidth});
            mainBoxOffset = mainBox.parent().offset();
        }

        function onSubmit(e) {
            e.preventDefault();
            ajax.abort();
            fetching = false;
            searchString = stringInput.val();
            filter = getStrCat();
            offset = 0;
            tableBody.html('');
            updateMainBoxSize();
            fetchMore();
        }

        function getStrCat() {
            var strCat = '';
            $.each(categoryInput, function(key, value) {
                if($(value).is(":checked")) {
                    strCat += $(value).val()+',';
                }
            });
            return strCat;
        }

        function onLogScroll(e) {
            var scrollValue = $(document).scrollTop()+$(window).height();
            var scrollMax = $(document).height();
            if(scrollValue+200 >= scrollMax) {
                if(!isLast) fetchMore();
            }
            fixedIfScrolled();
        }

        function fixedIfScrolled() {
            if($(document).scrollTop()+50 >= mainBoxOffset.top) {
                if(mainBox.is(":visible")) {
                    fixMainBox(true);
                }
            } else {
                if(mainBox.is(":visible")) {
                    fixMainBox(false);
                }
            }
        }

        function fixMainBox(yes) {
            if(yes) {
                mainBox.css({
                    'position':'fixed',
                    'top':0,
                    'left':mainBoxOffset.left+15,
                    'margin-top':50
                });
            }
            else {
                mainBox.css({
                    'position':'relative',
                    'margin-top':0,
                    'left':'auto'
                });
            }
        }

        function hideItemBoxIfEmpty() {
            if($('.multi-selector-item', multiSelectorBox).length) {
                mainBox.css({'display':'block'});
            } else {
                mainBox.hide({'display':'none'});
            }
        }

        function onListButtonAdd(e) {
            if($('#multiSelectorItem'+$(e.currentTarget).val()).length || ($('.multi-selector-item', multiSelectorBox).length >= itemLimit)) {
            } else {
                multiSelectorBox.append(
                    $('<span id="multiSelectorItem'+$(e.currentTarget).val()+'" data-target="'+$(e.currentTarget).val()+'" data-name="'+$(e.currentTarget).attr('data-name')+'" class="multi-selector-item">'+$(e.currentTarget).attr('data-name')+'</span>')
                        .append(
                            $('<span class="small multi-selector-close" data-target="'+$(e.currentTarget).val()+'">x</span></span>').click(onItemClose)
                        )
                );
                onMultiSelectorBoxItemChange();
            }
            hideItemBoxIfEmpty();
            fixedIfScrolled();
        }

        function onItemClose(e) {
            $('span[id=multiSelectorItem'+$(e.currentTarget, multiSelectorBox).attr('data-target')+']').remove();
            onMultiSelectorBoxItemChange();
            hideItemBoxIfEmpty();
        }

        function onMultiSelectorBoxItemChange() {
            var ids = '';
            var names = '';
            $.each($('.multi-selector-item', multiSelectorBox), function(key, value) {
                ids += $(value).attr('data-target')+',';
                names += $(value).attr('data-name')+',';
            });
            $('#submitAuthorId').val(ids);
            $('#submitAuthorName').val(names);
            log( $('#submitAuthorId').val());
            log($('#submitAuthorName').val());
        }

        function fetchMore() {
            if(fetching) return;
            fetching = true;
            tableFootTr.show();
            ajax = $.ajax( {
                type: 'GET',
                data: {'string':searchString, 'filter':filter, 'offset':offset, 'limit':limit},
                url: actionUrl,
                dataType: 'jsonp',
                beforeSend: function(jqXHR, settings) {

                },
                complete: function(jqXHR, textStatus) {
                    if(textStatus != 'success') {
                    }
                },
                success: function(data, textStatus, jqXHR) {
                    offset += limit;
                    $.each(data.authors, function(key, value) {
                        tableBody.append(
                            '<tr>'+
                                '<td><div style="height: 50px; width: 50px; background-size: contain; background-image: url(\''+value.photoUrl+'\')"></div></td>'+
                                '<td>'+value.firstName+'</td>'+
                                '<td>'+value.lastName+'</td>'+
                                '<td>'+
                                '<form method="post" action="">'+
                                '<button type="button" id="authorListItem'+value.id+'" class="author-list-add-button btn btn-default" value="'+value.id+'" data-name="'+value.firstName+' '+value.lastName+'">add</button>'+
                                '<input type="hidden" name="authorFirstName" value="">'+
                                '<input type="hidden" name="authorLastName" value="">'+
                                '</form>'+
                                '</td>'+
                                '</tr>'
                        );
                    });
                    fetching = false;
                    tableFootTr.hide();
                    if(offset >= data.total) isLast = true;
                    else isLast = false;
                    $('.author-list-add-button').unbind('click').click(onListButtonAdd);
                    updateMainBoxSize();
                }
            });
        }

        init();
    })(jQuery);

    /* #articleAuthorSelectModal */
    (function($) {

        var modal = $('#articleAuthorSelectModal');
        var searchButton = $('#authorSearchSubmit', modal);
        var actionUrl = 'http://www.vigattintourism.com/service/author';
        var stringInput = $('#authorSearchString', modal);
        var resultContainer = $('#authorResultListContainer', modal);
        var categoryInput = $('.authorSearchCategories', modal);
        var selectedAuthors = $('.selected-authors', modal);
        var ajax;
        var fetching = false;
        var loader = $('#authorSearchTablePreloader', modal);
        var tableBody = $('#authorSearchTable', modal);
        var offset = 0;
        var limit = 10;
        var isLast = false;
        var maxItem = 10;

        function onFetchCurrentAuthors(authors) {
            $.each(authors, function(key, value) {
                var button =  $('<button type="button" value="'+value.id+'" data-name="'+value.firstName+' '+value.lastName+'">add</button>');
                button.click(onAddAuthor);
                button.trigger('click');
            });
            $('.body-content', modal).show();
            $('.body-loader', modal).hide();
        }

        function onSearchClick(e) {
            fetching = false;
            offset = 0;
            isLast = false;
            tableBody.html('');
            fetchMore();
        }

        function onTextInputKeydown(e) {
            if(e.which == 13) {
                onSearchClick(e);
                return false;
            }
        }

        function onAddAuthor(e) {
            var id = $(e.currentTarget).val();
            var name = $(e.currentTarget).attr('data-name');
            var item;
            if($('.multi-selector-item', selectedAuthors).length >= maxItem) return;
            if(!$('#author_'+id, selectedAuthors).length) {
                selectedAuthors.show();
                item = $('<div class="multi-selector-item" id="author_'+id+'" author="'+id+'"><span class="author-name">'+name+'</span> <span class="multi-selector-close" data-target="#author_'+id+'">x</span></div>');
                $('.multi-selector-close', item).click(onRemoveAuthor);
                selectedAuthors.append(item);
                generateKeywords();
            }
        }

        function onRemoveAuthor(e) {
            var dataTarget = $(e.currentTarget).attr('data-target');
            $(dataTarget, selectedAuthors).remove();
            generateKeywords();
            if(!$('.multi-selector-item', selectedAuthors).length) selectedAuthors.hide();
        }

        function onScroll(e) {
            if(e.currentTarget.scrollHeight <= ((e.currentTarget.offsetHeight + e.currentTarget.scrollTop)+50)) {
                if(!isLast) fetchMore();
            }
        }

        function init(e) {
            $('.body-content', modal).hide();
            $('.body-loader', modal).show();
            selectedAuthors.html('');
            fetchCurrentAuthors();
            $(searchButton).unbind('click').click(onSearchClick);
            tableBody.html('');
            selectedAuthors.hide();
            fetching = false;
            offset = 0;
            isLast = false;
            stringInput.val('').unbind('keydown').keydown(onTextInputKeydown);
            loader.hide();
            resultContainer.unbind('scroll').scroll(onScroll);
        }

        function fetchMore() {
            if(fetching) return;
            fetching = true;
            loader.show();
            ajax = $.ajax( {
                type: 'GET',
                data: {'string':stringInput.val(), 'filter':getStrCat(), 'offset':offset, 'limit':limit},
                url: actionUrl,
                dataType: 'jsonp',
                complete: function(jqXHR, textStatus) {
                    if(textStatus != 'success') {
                        setTimeout(function(){fetchMore()}, 3000);
                    }
                },
                success: function(data, textStatus, jqXHR) {
                    offset += limit;
                    var item;
                    $.each(data.authors, function(key, value) {
                        item =  $('<tr>'+
                            '<td><div style="height: 50px; width: 50px; background-size: contain; background-image: url(\''+value.photoUrl+'\')"></div></td>'+
                            '<td class="text-center full-name">'+value.firstName+' '+value.lastName+'</td>'+
                            '<td class="text-right">'+
                            '<button type="button" id="authorListItem'+value.id+'" class="author-list-add-button btn btn-default" value="'+value.id+'" data-name="'+value.firstName+' '+value.lastName+'">add</button>'+
                            '</td>'+
                            '</tr>');
                        $('button', item).click(onAddAuthor);
                        tableBody.append(item);
                    });
                    fetching = false;
                    loader.hide();
                    if(offset >= data.total) isLast = true;
                    else isLast = false;
                }
            });
        }

        function getStrCat() {
            var strCat = '';
            $.each(categoryInput, function(key, value) {
                if($(value).is(":checked")) {
                    strCat += $(value).val()+',';
                }
            });
            return strCat;
        }

        function generateKeywords() {
            var keywords = [];
            var keywordsRightSide = '';
            var keywordsFooter = '';
            var id;
            keywords[0] = '';
            keywords[1] = '';
            keywords[2] = '';
            $('.multi-selector-item', selectedAuthors).each(function(key, value) {
                id = $(value).attr('author');
                keywords[0] += '(tourism article header '+id+')';
                keywords[1] += '(tourism article rightside '+id+')';
                keywords[2] += '(tourism article footer '+id+')';
            });
            $('.tourism-cat-checkbox').each(function(key, value) {
                $(value).val(keywords[key]);
            });
        }

        function fetchCurrentAuthors() {
            $.ajax( {
                type: 'GET',
                data: {'ids':getIdsFromCheckBoxValue(), 'limit':10},
                url: actionUrl,
                dataType: 'jsonp',
                success: function(data, textStatus, jqXHR) {
                    onFetchCurrentAuthors(data.authors);
                }
            });
        }

        function getIdsFromCheckBoxValue() {
            var checkBox = $('.tourism-cat-checkbox')[0];
            var id;
            var ids = '';
            $.each($(checkBox).val().split(')'), function(key, value) {
                id = value.replace( /^\D+/g, '');
                if(id) ids += id+',';
            });
            return ids;
        }

        $(modal).on('show.bs.modal', init);

    })(jQuery);

    /* trade Accordion */
    (function($){
        $('.trade-accordion').hide();
        $('.trade-accordion-dropdown').click(function(e) {
            $(e.currentTarget).next().slideDown();
            var sibling = $(e.currentTarget).parent().siblings().find('.trade-accordion').slideUp();
        });
        $('.trade-accordion-final').click(function(e){
            $('#tradeChangeCategoryModal').modal('hide');
            var catInput = $('<input type="hidden" name="tradeStringCategory">');
            var catForm = $('<form action="" method="post"></form>');
            catInput.val($(e.currentTarget).attr('data-category'));
            catForm.append(catInput);
            catForm.submit();
        });
    })(jQuery);

    /* pagination goto-page */
    (function($){
        $('.goto-page .jump-to-page-button').click(function(e) {
            window.location = $(e.currentTarget).attr('data-url')+$('.goto-page .jump-to-page-input').val();
        });
    })(jQuery);
});